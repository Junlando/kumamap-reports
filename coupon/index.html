<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>æ—¥æœ¬å„ªæƒ åˆ¸ç¸½æ•´ç†ï½œå®¶é›»ã€è—¥å¦ã€é›œè²¨å…¨æ”¶éŒ„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="æ—¥æœ¬è³¼ç‰©å¿…å‚™å„ªæƒ åˆ¸ï¼Bic Cameraã€æ¾æœ¬æ¸…ã€å¤§åœ‹è—¥å¦ã€å”å‰è¨¶å¾·ã€å¤šæ…¶å±‹ç­‰é›»å™¨ã€è—¥å¦ã€é›œè²¨åº—å®¶å„ªæƒ åˆ¸å…¨æ”¶éŒ„ï¼Œé…åˆå…ç¨…çœè¶…å¤šã€‚"
  />
  <style>
    :root {
      --primary: #ff6b35;
      --primary-dark: #e55a2b;
      --bg: #ffffff;
      --bg-light: #f8f9fa;
      --text: #333333;
      --text-light: #666666;
      --text-lighter: #999999;
      --border: #e0e0e0;
      --shadow: rgba(0, 0, 0, 0.1);
      --pink: #ffe5e5;
      --pink-dark: #ffcccc;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", "PingFang TC", "Helvetica Neue", Arial, sans-serif;
      background: var(--bg-light);
      color: var(--text);
      line-height: 1.6;
      padding-bottom: 80px;
    }

    .header {
      background: var(--primary);
      color: white;
      padding: 16px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 8px var(--shadow);
    }

    .header h1 {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .search-bar {
      position: relative;
      margin-top: 8px;
    }

    .search-bar input {
      width: 100%;
      padding: 10px 16px 10px 40px;
      border: none;
      border-radius: 20px;
      background: white;
      font-size: 14px;
      color: var(--text);
    }

    .search-bar input::placeholder {
      color: var(--text-lighter);
    }

    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 20px;
      opacity: 0.5;
    }

    .category-filters {
      display: flex;
      gap: 8px;
      padding: 16px;
      overflow-x: auto;
      background: white;
      border-bottom: 1px solid var(--border);
      -webkit-overflow-scrolling: touch;
    }

    .category-filters::-webkit-scrollbar {
      display: none;
    }

    .category-btn {
      padding: 8px 16px;
      border: 1px solid var(--border);
      border-radius: 20px;
      background: white;
      color: var(--text);
      font-size: 14px;
      white-space: nowrap;
      cursor: pointer;
      transition: all 0.2s;
    }

    .category-btn.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .coupon-list {
      padding: 16px;
      max-width: 800px;
      margin: 0 auto;
    }

    .coupon-card {
      background: white;
      border-radius: 12px;
      margin: 0 auto 16px;
      max-width: 600px;
      overflow: hidden;
      box-shadow: 0 2px 8px var(--shadow);
      transition: transform 0.2s, box-shadow 0.2s;
      position: relative;
      background-image: url('drawables/coupon_frame.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    .coupon-card-inner {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      overflow: hidden;
    }

    .coupon-card:active {
      transform: scale(0.98);
    }

    .coupon-header {
      background: linear-gradient(135deg, #ffe5e5 0%, #ffcccc 100%);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .store-icon {
      width: 48px;
      height: 48px;
      border-radius: 8px;
      object-fit: contain;
      background: white;
      padding: 4px;
    }

    .store-info {
      flex: 1;
      min-width: 0;
    }

    .store-name {
      font-size: 16px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 2px;
    }

    .favorite-btn {
      width: 24px;
      height: 24px;
      border: none;
      background: none;
      cursor: pointer;
      padding: 0;
      flex-shrink: 0;
    }

    .favorite-icon {
      width: 24px;
      height: 24px;
      fill: white;
      stroke: var(--text-light);
      stroke-width: 2;
    }

    .favorite-btn.active .favorite-icon {
      fill: var(--primary);
      stroke: var(--primary);
    }

    .coupon-body {
      padding: 16px;
      display: flex;
      border-top: 2px dashed var(--border);
      position: relative;
    }

    .coupon-body::before {
      content: '';
      position: absolute;
      left: 50%;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--border);
      transform: translateX(-50%);
    }

    .coupon-left {
      flex: 1;
      padding-right: 16px;
      text-align: center;
    }

    .discount-label {
      font-size: 12px;
      color: var(--text-light);
      margin-bottom: 4px;
    }

    .discount-number {
      font-size: 36px;
      font-weight: 700;
      color: var(--primary);
      line-height: 1;
      margin-bottom: 4px;
    }

    .discount-unit {
      font-size: 14px;
      color: var(--text-light);
    }

    .coupon-right {
      flex: 1;
      padding-left: 16px;
    }

    .coupon-description {
      font-size: 14px;
      color: var(--text);
      line-height: 1.5;
      margin-bottom: 8px;
      white-space: pre-line;
    }

    .deadline {
      font-size: 12px;
      color: var(--text-lighter);
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-light);
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .empty-state-text {
      font-size: 16px;
    }

    /* App ä¸‹è¼‰å€å¡Š */
    .app-banner {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 16px;
      border-radius: 12px;
      margin: 16px auto;
      max-width: 600px;
      text-align: center;
      box-shadow: 0 4px 12px var(--shadow);
    }

    .app-banner h3 {
      font-size: 18px;
      margin-bottom: 12px;
      font-weight: 700;
    }

    .app-banner p {
      font-size: 14px;
      margin-bottom: 16px;
      opacity: 0.95;
    }

    .app-links {
      display: flex;
      gap: 12px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }

    .app-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: white;
      color: var(--primary);
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      transition: transform 0.2s;
    }

    .app-link:hover {
      transform: scale(1.05);
    }

    .app-link:active {
      transform: scale(0.95);
    }

    .app-link img {
      width: 24px;
      height: 24px;
    }

    .qrcode-container {
      display: none;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid rgba(255, 255, 255, 0.3);
    }

    .qrcode-container.show {
      display: block;
    }

    .qrcode-wrapper {
      display: flex;
      gap: 16px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .qrcode-item {
      text-align: center;
    }

    .qrcode-item img {
      width: 120px;
      height: 120px;
      border-radius: 8px;
      background: white;
      padding: 8px;
      margin-bottom: 8px;
    }

    .qrcode-item label {
      display: block;
      font-size: 12px;
      opacity: 0.9;
    }

    /* æ‡¸æµ®æ©«å¹… */
    .sticky-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--primary);
      color: white;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 1000;
      box-shadow: 0 -2px 12px var(--shadow);
      transform: translateY(100%);
      transition: transform 0.3s;
    }

    .sticky-banner.show {
      transform: translateY(0);
    }

    .sticky-banner-content {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .sticky-banner-icon {
      width: 40px;
      height: 40px;
      background: white;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .sticky-banner-text {
      flex: 1;
    }

    .sticky-banner-text strong {
      display: block;
      font-size: 14px;
      font-weight: 700;
    }

    .sticky-banner-text span {
      display: block;
      font-size: 12px;
      opacity: 0.9;
    }

    .sticky-banner-close {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .sticky-banner-btn {
      padding: 8px 16px;
      background: white;
      color: var(--primary);
      border-radius: 6px;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      white-space: nowrap;
    }

    @media (max-width: 600px) {
      .header h1 {
        font-size: 18px;
      }

      .coupon-body {
        flex-direction: column;
      }

      .coupon-body::before {
        display: none;
      }

      .coupon-left {
        padding-right: 0;
        padding-bottom: 12px;
        border-bottom: 1px dashed var(--border);
        margin-bottom: 12px;
      }

      .coupon-right {
        padding-left: 0;
      }

      .sticky-banner {
        flex-direction: column;
        gap: 8px;
        padding: 12px;
      }

      .sticky-banner-content {
        width: 100%;
      }

      .sticky-banner-btn {
        width: 100%;
        text-align: center;
      }
    }

    @media (min-width: 768px) {
      .qrcode-container {
        display: block;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>æ—¥æœ¬å„ªæƒ åˆ¸</h1>
    <div class="search-bar">
      <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <input type="text" id="search-input" placeholder="æœå°‹å„ªæƒ åˆ¸" />
    </div>
  </div>

  <div class="category-filters" id="category-filters">
    <button class="category-btn active" data-category="all">å…¨éƒ¨</button>
    <button class="category-btn" data-category="drugstoreAndDaily">è—¥å¦</button>
    <button class="category-btn" data-category="electronics">é›»å™¨</button>
    <button class="category-btn" data-category="departmentStore">ç™¾è²¨</button>
    <button class="category-btn" data-category="airportDutyFree">æ©Ÿå ´</button>
    <button class="category-btn" data-category="fashion">æœé£¾é…</button>
    <button class="category-btn" data-category="sports">é‹å‹•</button>
    <button class="category-btn" data-category="animeAndGoods">å‹•æ¼«</button>
    <button class="category-btn" data-category="online">ç·šä¸Š</button>
  </div>

  <div class="coupon-list" id="coupon-list">
    <div class="empty-state">
      <div class="empty-state-icon">ğŸ“‹</div>
      <div class="empty-state-text">è¼‰å…¥ä¸­...</div>
    </div>
  </div>

  <!-- æ‡¸æµ®æ©«å¹… -->
  <div class="sticky-banner" id="sticky-banner">
    <div class="sticky-banner-content">
      <div class="sticky-banner-icon">ğŸ“±</div>
      <div class="sticky-banner-text">
        <strong>ä¸‹è¼‰ App äº«å—æ›´å¤šå„ªæƒ </strong>
        <span>éš¨æ™‚éš¨åœ°è¼•é¬†ç²å–æŠ˜æ‰£</span>
      </div>
      <button class="sticky-banner-close" onclick="closeStickyBanner()">Ã—</button>
    </div>
    <a href="#" class="sticky-banner-btn" id="sticky-app-link" onclick="event.preventDefault(); openAppStore()">ç«‹å³ä¸‹è¼‰</a>
  </div>

  <script>
    // App Store é€£çµ
    const APP_STORE_URL = 'https://apps.apple.com/tw/app/%E6%97%A5%E6%9C%AC%E5%84%AA%E6%83%A0%E5%88%B8-2025-%E6%97%A5%E6%9C%AC%E8%B3%BC%E7%89%A9-%E6%97%85%E9%81%8A%E5%BF%85%E5%82%99-%E6%97%A5%E5%B9%A3%E6%8F%9B%E7%AE%97/id6449156306';
    const GOOGLE_PLAY_URL = 'https://play.google.com/store/apps/details?id=com.junlando.japancoupon';

    // æª¢æ¸¬è¨­å‚™é¡å‹
    function detectDevice() {
      const userAgent = navigator.userAgent || navigator.vendor || window.opera;
      if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
        return 'ios';
      } else if (/android/i.test(userAgent)) {
        return 'android';
      }
      return 'desktop';
    }

    // ç²å–å°æ‡‰çš„ App Store é€£çµ
    function getAppStoreUrl() {
      const device = detectDevice();
      if (device === 'ios') {
        return APP_STORE_URL;
      } else if (device === 'android') {
        return GOOGLE_PLAY_URL;
      }
      // æ¡Œé¢ç‰ˆé è¨­é¡¯ç¤º Google Playï¼ˆæˆ–å¯ä»¥è®“ç”¨æˆ¶é¸æ“‡ï¼‰
      return GOOGLE_PLAY_URL;
    }

    // é–‹å•Ÿ App Store
    function openAppStore() {
      window.open(getAppStoreUrl(), '_blank');
    }

    // é—œé–‰æ‡¸æµ®æ©«å¹…
    function closeStickyBanner() {
      const banner = document.getElementById('sticky-banner');
      banner.classList.remove('show');
      localStorage.setItem('coupon_banner_closed', 'true');
    }

    // é¡¯ç¤ºæ‡¸æµ®æ©«å¹…
    function showStickyBanner() {
      if (localStorage.getItem('coupon_banner_closed') === 'true') {
        return;
      }
      const banner = document.getElementById('sticky-banner');
      setTimeout(() => {
        banner.classList.add('show');
      }, 2000); // 2ç§’å¾Œé¡¯ç¤º
    }

    // å‰µå»º App å®£å‚³å¡ç‰‡
    function createAppCard() {
      const device = detectDevice();
      const isDesktop = device === 'desktop';
      
      return `
        <div class="app-banner">
          <h3>ğŸ“± ä¸‹è¼‰ App äº«å—æ›´å¤šå„ªæƒ </h3>
          <p>éš¨æ™‚éš¨åœ°è¼•é¬†ç²å–æŠ˜æ‰£ï¼Œå†ä¹Ÿä¸ç”¨åˆ°è™•æœå°‹ä¸‹è¼‰å„²å­˜ï¼</p>
          <div class="app-links">
            <a href="${APP_STORE_URL}" class="app-link" target="_blank" onclick="event.stopPropagation()">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.05 20.28c-.98.95-2.47.88-3.37-.1-1.01-1.01-2.12-2.12-3.37-3.37-1.25-1.25-2.36-2.36-3.37-3.37-.98-.9-1.05-2.39-.1-3.37.95-.98 2.44-1.05 3.37-.1.9.9 1.88 1.88 2.77 2.77.89.89 1.87 1.87 2.77 2.77.95.93.88 2.42-.1 3.37zm-4.84-4.84c.9.9 1.88 1.88 2.77 2.77.93.95 2.42.88 3.37-.1.98-.95 1.05-2.44.1-3.37-.9-.9-1.88-1.88-2.77-2.77-.89-.89-1.87-1.87-2.77-2.77-.93-.95-2.42-.88-3.37.1-.98.95-1.05 2.44-.1 3.37.9.9 1.88 1.88 2.77 2.77z"/>
              </svg>
              App Store
            </a>
            <a href="${GOOGLE_PLAY_URL}" class="app-link" target="_blank" onclick="event.stopPropagation()">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3,20.5V3.5C3,2.91 3.34,2.39 3.84,2.15L13.69,12L3.84,21.85C3.34,21.6 3,21.09 3,20.5M16.81,15.12L6.05,21.34L14.54,12.85L16.81,15.12M20.16,10.81C20.5,11.08 20.75,11.5 20.75,12C20.75,12.5 20.53,12.9 20.18,13.18L17.89,14.5L15.39,12L17.89,9.5L20.16,10.81M6.05,2.66L16.81,8.88L14.54,11.15L6.05,2.66Z"/>
              </svg>
              Google Play
            </a>
          </div>
          ${isDesktop ? `
            <div class="qrcode-container show">
              <div class="qrcode-wrapper">
                <div class="qrcode-item">
                  <img src="drawables/ios_qrcode.png" alt="iOS QR Code" />
                  <label>iOS æƒç¢¼ä¸‹è¼‰</label>
                </div>
                <div class="qrcode-item">
                  <img src="drawables/android_qrcode.png" alt="Android QR Code" />
                  <label>Android æƒç¢¼ä¸‹è¼‰</label>
                </div>
              </div>
            </div>
          ` : ''}
        </div>
      `;
    }

    // åˆå§‹åŒ–æ‡¸æµ®æ©«å¹…é€£çµ
    document.addEventListener('DOMContentLoaded', () => {
      const stickyLink = document.getElementById('sticky-app-link');
      if (stickyLink) {
        stickyLink.href = getAppStoreUrl();
      }
      showStickyBanner();
    });
    let coupons = [];
    let filteredCoupons = [];
    let currentCategory = 'all';
    let searchQuery = '';

    // åˆ†é¡åç¨±å°æ‡‰
    const categoryNames = {
      all: 'å…¨éƒ¨',
      drugstoreAndDaily: 'è—¥å¦',
      electronics: 'é›»å™¨',
      departmentStore: 'ç™¾è²¨',
      airportDutyFree: 'æ©Ÿå ´',
      fashion: 'æœé£¾é…',
      sports: 'é‹å‹•',
      animeAndGoods: 'å‹•æ¼«',
      online: 'ç·šä¸Š'
    };

    // è¼‰å…¥å„ªæƒ åˆ¸è³‡æ–™
    async function loadCoupons() {
      try {
        const response = await fetch('coupons.json');
        coupons = await response.json();
        filteredCoupons = [...coupons];
        renderCoupons();
      } catch (error) {
        console.error('è¼‰å…¥å„ªæƒ åˆ¸å¤±æ•—:', error);
        document.getElementById('coupon-list').innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">âŒ</div>
            <div class="empty-state-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>
          </div>
        `;
      }
    }

    // æ ¼å¼åŒ–æˆªæ­¢æ—¥æœŸ
    function formatDeadline(timestamp) {
      if (!timestamp) return 'ç„¡é™æœŸ';
      const date = new Date(timestamp * 1000);
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `æˆªæ­¢æ—¥æœŸ: ${year}/${month}/${day}`;
    }

    // ç²å–åœ–æ¨™è·¯å¾‘
    function getIconPath(imageName) {
      // æ ¹æ“š imageName æ˜ å°„åˆ°å¯¦éš›çš„æ–‡ä»¶å
      const iconMap = {
        'donki': 'donki.jpeg',
        'matsu': 'matsu.png',
        'big_camera': 'big_camera.png',
        'daikoku': 'daikoku.jpg',
        'sapporo': 'sapporo.jpeg',
        'daimaru': 'daimaru.png',
        'victoria': 'victoria.png',
        'mitsui': 'mitsui.png',
        'edion': 'edion.png',
        'duty_free': 'duty_free.png',
        'aeon': 'aeon.png',
        'aeon_mall': 'aeon_mall.png',
        'tsuruha': 'tsuruha.png',
        'keio': 'keio.png',
        'sundrug': 'sundrug.jpeg',
        'tobu': 'tobu.png',
        'cosmos': 'cosmos.png',
        'cosmetics': 'cosmetics.png',
        'takeya': 'takeya.png',
        'yamada': 'yamada.png',
        'alphen_tokyo': 'alphen_tokyo.png',
        'laox': 'laox.png',
        'gu': 'gu.png',
        'sugi': 'sugi.png',
        'ana': 'ana.png',
        'new1': 'new1.jpg',
        'west': 'west.png',
        'kokumin': 'kokumin.jpg',
        'cocokarafine': 'cocokarafine.png',
        'odakyu': 'odakyu.jpg',
        'aoki': 'aoki.png',
        'orihica': 'orihica.png',
        'wamazing': 'wamazing.png',
        'fasola': 'fasola.png',
        'snowpeak': 'snowpeak.png',
        'jungle': 'jungle.png',
        'briefing': 'briefing.png',
        'aoyama': 'aoyama.png',
        'paris': 'paris.jpeg',
        'ohga': 'ohga.png',
        'meitetsu': 'meitetsu.png',
        'lotte': 'lotte.jpeg'
      };
      
      const fileName = iconMap[imageName] || `${imageName}.png`;
      return `store_icons/${fileName}`;
    }

    // ç²å–å„ªæƒ åˆ¸åœ–ç‰‡è·¯å¾‘
    function getCouponImagePath(imageURL) {
      if (!imageURL) return null;
      // å¦‚æœæ˜¯ PDFï¼Œè½‰æ›ç‚º JPG
      if (imageURL.endsWith('.pdf')) {
        return `coupon_images/${imageURL.replace('.pdf', '.jpg')}`;
      }
      return `coupon_images/${imageURL}`;
    }

    // è™•ç†å„ªæƒ åˆ¸é»æ“Š
    function handleCouponClick(coupon) {
      if (coupon.link) {
        // å¦‚æœæœ‰é€£çµï¼Œç›´æ¥é–‹å•Ÿ
        window.open(coupon.link, '_blank');
      } else if (coupon.imageURL) {
        // å¦‚æœæœ‰åœ–ç‰‡ï¼Œé–‹å•Ÿåœ–ç‰‡
        const imagePath = getCouponImagePath(coupon.imageURL);
        if (imagePath) {
          // åœ¨æ–°è¦–çª—ä¸­é¡¯ç¤ºåœ–ç‰‡
          const newWindow = window.open('', '_blank');
          newWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
              <title>${coupon.title} - å„ªæƒ åˆ¸</title>
              <meta name="viewport" content="width=device-width, initial-scale=1">
              <style>
                body {
                  margin: 0;
                  padding: 20px;
                  background: #f5f5f5;
                  display: flex;
                  justify-content: center;
                  align-items: center;
                  min-height: 100vh;
                }
                img {
                  max-width: 100%;
                  height: auto;
                  border-radius: 8px;
                  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                }
              </style>
            </head>
            <body>
              <img src="${imagePath}" alt="${coupon.title}" onerror="this.parentElement.innerHTML='<p>åœ–ç‰‡è¼‰å…¥å¤±æ•—</p>'" />
            </body>
            </html>
          `);
        }
      }
    }

    // æ¸²æŸ“å„ªæƒ åˆ¸åˆ—è¡¨
    function renderCoupons() {
      const listEl = document.getElementById('coupon-list');
      
      if (filteredCoupons.length === 0) {
        listEl.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ”</div>
            <div class="empty-state-text">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„å„ªæƒ åˆ¸</div>
          </div>
        `;
        return;
      }

      // æ¯éš” 4 å¼µå¡ç‰‡æ’å…¥ä¸€å€‹ App å®£å‚³å¡ç‰‡
      const items = [];
      filteredCoupons.forEach((coupon, index) => {
        items.push({ type: 'coupon', data: coupon });
        if ((index + 1) % 4 === 0 && index < filteredCoupons.length - 1) {
          items.push({ type: 'app', data: null });
        }
      });

      listEl.innerHTML = items.map((item, index) => {
        if (item.type === 'app') {
          return createAppCard();
        }
        
        const coupon = item.data;
        const iconPath = getIconPath(coupon.imageName);
        const deadlineText = formatDeadline(coupon.deadline);
        const couponData = JSON.stringify(coupon).replace(/"/g, '&quot;');
        
        return `
          <div class="coupon-card" data-coupon-id="${coupon.id}">
            <div class="coupon-card-inner">
              <div class="coupon-header">
                <img src="${iconPath}" alt="${coupon.title}" class="store-icon" onerror="this.src='store_icons/icon.png'" />
                <div class="store-info">
                  <div class="store-name">${coupon.title}</div>
                </div>
                <button class="favorite-btn" onclick="event.stopPropagation(); toggleFavorite(${coupon.id})">
                  <svg class="favorite-icon" viewBox="0 0 24 24">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                  </svg>
                </button>
              </div>
              <div class="coupon-body">
                <div class="coupon-left">
                  <div class="discount-label">${coupon.discount}</div>
                  <div class="discount-number">${coupon.discountNumber}</div>
                  <div class="discount-unit">${coupon.discountUnit}</div>
                </div>
                <div class="coupon-right">
                  <div class="coupon-description">${coupon.description}</div>
                  <div class="deadline">${deadlineText}</div>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');

      // æ·»åŠ é»æ“Šäº‹ä»¶
      let couponIndex = 0;
      listEl.querySelectorAll('.coupon-card').forEach((card) => {
        const currentIndex = couponIndex;
        couponIndex++;
        card.addEventListener('click', () => {
          handleCouponClick(filteredCoupons[currentIndex]);
        });
      });
    }

    // ç¯©é¸å„ªæƒ åˆ¸
    function filterCoupons() {
      filteredCoupons = coupons.filter(coupon => {
        // åˆ†é¡ç¯©é¸
        if (currentCategory !== 'all' && coupon.type !== currentCategory) {
          return false;
        }
        
        // æœå°‹ç¯©é¸
        if (searchQuery) {
          const query = searchQuery.toLowerCase();
          return coupon.title.toLowerCase().includes(query) ||
                 coupon.description.toLowerCase().includes(query);
        }
        
        return true;
      });
      
      renderCoupons();
    }

    // åˆ†é¡æŒ‰éˆ•é»æ“Š
    document.getElementById('category-filters').addEventListener('click', (e) => {
      if (e.target.classList.contains('category-btn')) {
        // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        document.querySelectorAll('.category-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        e.target.classList.add('active');
        
        // æ›´æ–°åˆ†é¡
        currentCategory = e.target.dataset.category;
        filterCoupons();
      }
    });

    // æœå°‹è¼¸å…¥
    document.getElementById('search-input').addEventListener('input', (e) => {
      searchQuery = e.target.value;
      filterCoupons();
    });

    // æ”¶è—åŠŸèƒ½ï¼ˆå¯é¸ï¼‰
    function toggleFavorite(id) {
      // é€™è£¡å¯ä»¥å¯¦ç¾æ”¶è—åŠŸèƒ½
      const btn = event.target.closest('.favorite-btn');
      btn.classList.toggle('active');
    }


    // åˆå§‹åŒ–
    loadCoupons();
  </script>
</body>
</html>

