<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Favicon -->
  <link rel="icon" href="/coupon/favicon/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="/coupon/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/coupon/favicon/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/coupon/favicon/apple-touch-icon.png">
  
  <title>2025 æ—¥æœ¬å„ªæƒ åˆ¸æ•´ç† è³¼ç‰©æ—…éŠå¿…å‚™! - Junlando</title>
  <meta
    name="description"
    content="è—¥å¦, å®¶é›», é›œè²¨,ç™¾è²¨å…¨æ”¶éŒ„,çœéŒ¢å¿…çœ‹ã€‚æ—¥æœ¬è³¼ç‰©å¿…å‚™å„ªæƒ åˆ¸ï¼Bic Cameraã€æ¾æœ¬æ¸…ã€å¤§åœ‹è—¥å¦ã€å”å‰è¨¶å¾·ã€å¤šæ…¶å±‹ç­‰é›»å™¨ã€è—¥å¦ã€é›œè²¨åº—å®¶å„ªæƒ åˆ¸å…¨æ”¶éŒ„ï¼Œé…åˆå…ç¨…çœè¶…å¤šã€‚"
  />
  <!-- Google Fonts - Inter & Inria Serif -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Inria+Serif:wght@400;700&display=swap" rel="stylesheet">
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    :root {
      --primary-color: #e53935;
      --accent-color: #ff9800;
      --background-color: #f5f5f5;
      --coupon-color: #f44336;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Arial', 'Microsoft JhengHei', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #fff;
    }

    /* æ¨™é¡Œå€å¡Š - æ ¹æ“š Figma Desktop 1200 è¨­è¨ˆï¼ˆæœ€æ–°èª¿æ•´ï¼‰ */
    .header-section {
      background: transparent;
      padding: 0;
      height: 199px; /* å¾ 236px æ”¹ç‚º 199px */
      position: relative;
      overflow: visible;
      border-bottom: none;
      box-shadow: none;
    }

    /* #ffebed èƒŒæ™¯åªåˆ° 136px */
    .header-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      width: 100%;
      height: 136px;
      background: #ffebed;
      z-index: 0;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
      height: 199px; /* å¾ 236px æ”¹ç‚º 199px */
      position: relative;
      padding: 0;
      z-index: 1;
    }

    .header-top-row {
      display: none;
    }

    .mobile-download-buttons {
      display: none;
      flex-direction: column;
      gap: 6px;
      align-items: flex-start;
    }

    .mobile-download-label {
      display: none;
      font-size: 13px;
      color: #666;
      font-weight: 500;
      margin-bottom: 4px;
      text-align: left;
      align-self: flex-start;
    }

    /* åº•éƒ¨æ°”æ³¡æç¤ºæ¡†ï¼ˆæ‰‹æ©Ÿç‰ˆåº•éƒ¨è—è‰²ä¸‹è¼‰ Bannerï¼‰ */
    .mobile-download-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, #0080FF 0%, #0066CC 100%);
      color: white;
      padding: 16px 20px;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      transform: translateY(100%);
      opacity: 0;
      transition: transform 0.3s ease-out, opacity 0.3s ease-out;
      pointer-events: none;
    }

    .mobile-download-banner.show {
      transform: translateY(0);
      opacity: 1;
      pointer-events: auto;
    }

    .mobile-download-banner.hide {
      transform: translateY(100%);
      opacity: 0;
    }

    @keyframes slideUp {
      from {
        transform: translateY(100%);
      }
      to {
        transform: translateY(0);
      }
    }

    @keyframes slideDown {
      from {
        transform: translateY(0);
      }
      to {
        transform: translateY(100%);
      }
    }

    .banner-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .banner-text {
      flex: 1;
      font-size: 14px;
      line-height: 1.4;
    }

    .banner-button {
      background: white;
      color: #0080FF;
      padding: 12px 24px;
      border-radius: 20px;
      font-weight: bold;
      text-decoration: none;
      font-size: 16px;
      white-space: nowrap;
      transition: transform 0.2s;
    }

    .banner-button:hover {
      transform: scale(1.05);
    }

    .mobile-download-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 48px;
      height: 48px;
      border-radius: 10px;
      background: #fff;
      border: 1px solid #ddd;
      text-decoration: none;
      transition: all 0.2s;
    }

    .mobile-download-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    .mobile-download-btn img {
      width: 32px;
      height: 32px;
      object-fit: contain;
    }

    /* Logo - æ ¹æ“š Figma Desktop 1200ï¼ˆæœ€æ–°èª¿æ•´ï¼‰: x:29, y:24, 90x90px */
    .logo-box {
      position: absolute;
      left: 29px;
      top: 24px; /* å¾ 34px æ”¹ç‚º 24px */
      width: 90px; /* å¾ 100px æ”¹ç‚º 90px */
      height: 90px; /* å¾ 100px æ”¹ç‚º 90px */
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      overflow: hidden;
      background: #d9d9d9;
    }

    .logo-box img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 12px;
    }

    /* æ¨™é¡Œ "æ—¥æœ¬å„ªæƒ åˆ¸" - Figmaï¼ˆæœ€æ–°èª¿æ•´ï¼‰: x:190, y:21, 40px, Bold */
    .main-title {
      position: absolute;
      left: 190px; /* å¾ 192px æ”¹ç‚º 190px */
      top: 21px;
    }

    .main-title h1 {
      font-size: 40px; /* å¾ 50px æ”¹ç‚º 40px */
      font-weight: 700;
      color: #422826;
      margin: 0;
      line-height: 48px; /* å¾ 61px æ”¹ç‚º 48px */
      font-family: 'Inter', 'Arial', 'Microsoft JhengHei', sans-serif;
    }

    /* å“ç‰Œ "JUNLANDO" - Figmaï¼ˆæœ€æ–°èª¿æ•´ï¼‰: x:192, y:90, 20px, Medium */
    .main-title h2 {
      position: absolute;
      left: 4px; /* ç›¸è¼ƒæ–¼ title å³ç§» 2px */
      top: 69px; /* 90 - 21 = 69 */
      font-size: 20px; /* å¾ 24px æ”¹ç‚º 20px */
      font-weight: 500;
      color: #422826;
      margin: 0;
      line-height: 24px; /* å¾ 29px æ”¹ç‚º 24px */
      font-family: 'Inter', 'Arial', 'Microsoft JhengHei', sans-serif;
    }

    .mobile-title {
      display: none;
    }

    /* æ¡Œé¢ç‰ˆé¡¯ç¤º subtitle - Figmaï¼ˆæœ€æ–°èª¿æ•´ï¼‰ */
    .header-subtitle-section {
      display: block !important;
      position: absolute;
      left: 353px; /* å¾ 266px æ”¹ç‚º 353px */
      top: 157px;
      z-index: 5;
      width: 494px; /* å¾ 669px æ”¹ç‚º 494px */
      height: 29px; /* å¾ 58px æ”¹ç‚º 29px */
    }

    .header-subtitle-section .subtitle-title {
      font-size: 24px;
      font-weight: 400; /* å¾ 500 æ”¹ç‚º 400 (Regular) */
      color: #605353;
      line-height: 29px; /* æ ¹æ“š Figma line-height: 29.045px */
      font-family: 'Inter', 'Arial', 'Microsoft JhengHei', sans-serif;
      margin: 0;
      padding: 0;
      display: block;
      width: 494px; /* å¾ 669px æ”¹ç‚º 494px */
      height: 29px; /* å¾ 58px æ”¹ç‚º 29px */
      text-align: center; /* å±…ä¸­å¯¹é½ */
      border: none;
      box-shadow: none;
      white-space: pre-line; /* ä¿ç•™æ›è¡Œç¬¦ï¼Œå…è¨±è‡ªå‹•æ›è¡Œ */
      word-wrap: break-word; /* å…è¨±é•·å–®è©æ›è¡Œ */
      overflow-wrap: break-word; /* ç¾ä»£ç€è¦½å™¨çš„æ›è¡Œå±¬æ€§ */
    }

    .header-subtitle-section .subtitle-description {
      display: none; /* åˆä½µå¾Œéš±è— description */
    }

    /* æ¡Œé¢ç‰ˆä¸‹è¼‰æŒ‰éˆ• - Figmaï¼ˆæœ€æ–°èª¿æ•´ï¼‰: Google Play x:762, y:38, 187x62px, App Store x:974, y:38, 187x62px */
    .desktop-download-section {
      position: absolute;
      right: 39px; /* 1200 - 974 - 187 = 39ï¼ˆå¾ 34px æ”¹ç‚º 39pxï¼‰ */
      top: 38px; /* å¾ 52px æ”¹ç‚º 38px */
      display: block !important;
      z-index: 10;
    }

    .download-box-wrapper {
      display: flex;
      gap: 25px; /* 974 - 762 - 187 = 25 */
      align-items: center;
    }

    .download-icon-btn {
      width: 187px;
      height: 62px;
      display: block;
      text-decoration: none;
    }

    .download-icon-btn img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .download-label {
      display: none; /* æ¡Œé¢ç‰ˆä½¿ç”¨åœ–æ¨™æŒ‰éˆ•ï¼Œä¸éœ€è¦æ–‡å­— */
    }

    .mobile-logo {
      display: none;
    }

    .brand-name {
      display: none;
    }

    /* ä¸»å°èˆª - æ ¹æ“š Figma Desktop 1200 è¨­è¨ˆï¼ˆæœ€æ–°æ›´æ–°ï¼‰ */
    .main-nav {
      background-color: #fff;
      height: 47px;
      display: flex;
      align-items: center;
      padding: 0;
      margin-bottom: 0;
      position: relative;
    }

    .main-nav ul {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0;
      list-style: none;
      display: flex;
      gap: 0;
      justify-content: flex-start;
      width: 100%;
      position: relative;
      padding-left: 119px; /* ç¬¬ä¸€å€‹æŒ‰éˆ•è·é›¢å·¦é‚Š 119px */
    }

    .main-nav li {
      padding: 0;
      height: 39px;
      width: 401px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Inria Serif', 'Arial', 'Microsoft JhengHei', serif;
      font-size: 18px; /* å¾ 16px æ”¹ç‚º 18px */
      font-weight: 400;
      border: 1px solid #e75e51;
      transition: all 0.2s;
      cursor: pointer;
      box-sizing: border-box;
      line-height: 22px; /* æ ¹æ“š Figma line-height: 21.58px */
    }

    /* ç¬¬äºŒå€‹æŒ‰éˆ•ä½ç½® - Figma: x:678, æ‰€ä»¥ margin-left: 678 - 119 - 401 = 158px */
    .main-nav li:nth-child(2) {
      margin-left: 158px; /* 678 - 119 - 401 = 158 */
    }

    .main-nav li.active {
      background-color: #e75e51;
      color: #ffffff !important;
      font-weight: 700; /* Bold */
      border: 1px solid #e75e51;
    }

    .main-nav li:not(.active) {
      background-color: #ffffff;
      color: #e75e51;
      border: 1px solid #e75e51;
      font-weight: 400; /* Regular */
    }

    .main-nav li:hover {
      opacity: 0.9;
    }

    /* æ‰‹æ©Ÿç‰ˆ Navigation - Figma: é«˜åº¦73px, æŒ‰éˆ•171x37, åœ“è§’10 */
    @media (max-width: 900px) {
      .main-nav {
        height: 73px;
        display: flex;
        align-items: center;
        padding: 0 16px;
      }

      .main-nav ul {
        width: 100%;
        display: flex;
        gap: 16px;
        justify-content: flex-start;
      }

      .main-nav li {
        padding: 0;
        height: 37px;
        min-width: 171px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: 'Inria Serif', 'Arial', 'Microsoft JhengHei', serif;
        font-size: 16px;
        font-weight: 400;
        border: 1px solid #e75e51;
        transition: all 0.2s;
      }

      .main-nav li.active {
        background-color: #e75e51;
        color: #ffffff !important;
        font-weight: 700;
        border: 1px solid #e75e51;
        border-bottom: none;
      }

      .main-nav li:not(.active) {
        background-color: #ffffff;
        color: #e75e51;
        border-bottom: 1px solid #e75e51;
      }

      .main-nav li:hover {
        color: #e75e51;
      }
    }

    /* ä¸»å…§å®¹å€å¡Š (Flex) */
    .container {
      max-width: 1352px;
      margin: 20px auto;
      display: flex;
      gap: 20px;
      padding: 0 20px;
    }

    .main-content {
      flex-grow: 1;
      width: 100%; /* æ¡Œé¢ç‰ˆç§»é™¤ sidebar å¾Œï¼Œmain-content ä½”æ»¿å¯¬åº¦ */
    }

    .sidebar {
      display: none; /* æ¡Œé¢ç‰ˆç§»é™¤ sidebar */
    }

    /* ç¯©é¸å™¨ - æ ¹æ“š Figma Desktop 1200 è¨­è¨ˆï¼ˆæœ€æ–°æ”¹ç‰ˆï¼šé«˜åº¦ 132pxï¼‰ */
    .filter-bar {
      background-color: transparent;
      padding: 0;
      margin: 0;
      margin-bottom: 0;
      border-radius: 0;
      border: none;
      width: 100%;
      position: relative;
      overflow: hidden;
      height: 132px;
    }

    /* #e75e51 èƒŒæ™¯è¦†è“‹å…¨å¯¬ï¼Œåªåˆ° search bar å€åŸŸ (78px) */
    .filter-bar::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      width: 100%;
      height: 78px; /* å¾ 88px æ”¹ç‚º 78px */
      background-color: #e75e51;
      z-index: 0;
    }

    /* Search bar åœ¨ä¸Šæ–¹ - Figma: x:41, y:276 (ç›¸å°æ–¼ filter y:257, æ‰€ä»¥æ˜¯ y:19), 871x40px (input), x:912, y:276, 246x40px (button) */
    .search-container {
      position: relative;
      z-index: 1;
      display: flex;
      gap: 0;
      margin: 19px auto 0; /* y:276 - y:257 = 19px */
      width: 100%;
      max-width: 1352px;
      padding: 0 41px; /* æ ¹æ“š Figma: x:41 */
      box-sizing: border-box;
    }

    .search-container input {
      width: 871px; /* æ ¹æ“š Figma */
      height: 40px; /* æ ¹æ“š Figma */
      font-size: 16px;
      padding: 0 35px; /* x:76 - x:41 = 35px */
      border: none;
      border-radius: 10px 0 0 10px; /* å·¦ä¸Šå·¦ä¸‹ 10px åœ“è§’ */
      background: #ffffff;
      color: #333;
      box-sizing: border-box;
      line-height: 19px; /* æ ¹æ“š Figma line-height: 19.36px */
    }

    .search-container input::placeholder {
      color: #b3b3b3;
      font-size: 16px; /* å¾ 20px æ”¹ç‚º 16px */
      font-weight: 400;
    }

    .search-container button {
      width: 246px;
      height: 40px;
      background-color: #ffa94d;
      color: #ffffff;
      border: none;
      border-radius: 0 10px 10px 0; /* å³ä¸Šå³ä¸‹ 10px åœ“è§’ */
      font-size: 16px;
      font-weight: 700;
      padding: 0;
      white-space: nowrap;
      cursor: pointer;
      transition: background-color 0.2s;
      line-height: 19px; /* æ ¹æ“š Figma line-height: 19.36px */
    }

    .search-container button:hover {
      background-color: #ff9800;
    }

    /* Category tabs åœ¨ä¸‹æ–¹ - Figma: y:335 (ç›¸å°æ–¼ filter y:257, æ‰€ä»¥æ˜¯ 78px), height: 44px, 20px font, Category Tab - ALL bg x:-2 */
    .category-tabs {
      position: absolute;
      top: 78px; /* y:335 - y:257 = 78px */
      left: 0;
      right: 0;
      z-index: 1;
      display: flex;
      flex-wrap: nowrap;
      gap: 0;
      margin: 0 auto;
      padding: 0;
      width: 100%;
      max-width: 1352px;
      box-sizing: border-box;
      justify-content: flex-start; /* ç½®å·¦å°é½Š */
      padding-left: 0; /* Category Tab - ALL bg x:-2ï¼Œå¾å·¦é‚Šé–‹å§‹ */
    }

    .category-tab {
      height: 44px; /* å¾ 56px æ”¹ç‚º 44px */
      min-width: auto;
      width: auto;
      padding: 0;
      white-space: nowrap;
      font-size: 20px; /* å¾ 25px æ”¹ç‚º 20px */
      font-weight: 400;
      font-family: 'Inter', 'Arial', 'Microsoft JhengHei', sans-serif;
      border: 1px solid #e75e51;
      border-radius: 0;
      background: #ffebed;
      color: #e75e51;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      margin-right: 0;
      box-sizing: border-box;
      line-height: 24px; /* æ ¹æ“š Figma line-height: 24.2px */
    }

    /* æ‰€æœ‰ category tab çµ±ä¸€å¯¬åº¦ - æ ¹æ“š Figma è¨­è¨ˆï¼Œæ¯å€‹éƒ½æ˜¯ 156px */
    .category-tab {
      width: 156px;
    }

    .category-tab.active {
      background-color: #e75e51;
      color: #ffffff;
      border: 1px solid #e75e51;
    }

    .category-tab:not(.active) {
      background-color: #ffebed;
      color: #e75e51;
      border: 1px solid #e75e51;
    }

    .category-tab:hover {
      opacity: 0.9;
    }

    /* å„ªæƒ åˆ¸å¡ç‰‡ - æ ¹æ“š Figma Desktop 1200 è¨­è¨ˆï¼Œä½¿ç”¨ç¶²æ ¼å¸ƒå±€ */
    .coupon-list {
      display: grid;
      grid-template-columns: repeat(4, 300px); /* å¾ 241px æ”¹ç‚º 270px */
      gap: 30px 20px; /* ä¸Šä¸‹è·é›¢ä¿æŒ 30pxï¼Œå·¦å³è·é›¢å¾ 47px æ”¹ç‚º 30px */
      padding: 20px 46px 0; /* å¢åŠ ä¸Šæ–¹ padding å¾ 0 æ”¹ç‚º 40pxï¼Œå¢åŠ èˆ‡ filter çš„è·é›¢ */
      max-width: 1200px;
      margin: 0 auto;
      justify-content: center; /* å¾ start æ”¹ç‚º centerï¼Œè®“æ•´å€‹å€åŸŸå±…ä¸­ */
    }

    .coupon-card {
      width: 300px; /* å¾ 241px æ”¹ç‚º 270px */
      height: 169px; /* å¾ 135px æ”¹ç‚º 150px */
      background-color: #fff;
      border: none;
      border-radius: 0;
      box-shadow: none;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      position: relative;
    }

    /* æ¡Œé¢ç‰ˆç›´æ¥ä½¿ç”¨ coupon_store åœ–ç‰‡ */
    .coupon-card.has-image .coupon-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 0;
      display: block;
    }

    .coupon-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .coupon-card-inner {
      background: rgba(255, 255, 255, 0.95);
    }

    .coupon-header {
      display: flex;
      align-items: center;
      padding: 10px;
      border-bottom: 1px dashed #eee;
      background: #ffe5e5;
    }

    .coupon-logo {
      width: 48px;
      height: 48px;
      border-radius: 8px;
      margin-right: 10px;
      object-fit: contain;
      background: white;
      padding: 4px;
    }

    .coupon-title {
      font-weight: 700;
      font-size: 20px;
      flex: 1;
    }

    .coupon-status {
      margin-left: auto;
      background-color: #0080FF;
      padding: 10px 18px;
      border-radius: 20px;
      font-size: 0.8em;
      color: white;
      font-weight: bold;
    }

    .coupon-details {
      padding: 15px;
      display: flex;
      align-items: center;
    }

    .discount-badge {
      background-color: var(--coupon-color);
      color: white;
      font-size: 2em;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 5px;
      margin-right: 15px;
      min-width: 80px;
      text-align: center;
    }

    .coupon-info {
      font-size: 0.9em;
      color: #555;
      flex: 1;
    }

    .coupon-info strong {
      color: var(--coupon-color);
    }

    .coupon-info small {
      display: block;
      color: #999;
      margin-top: 3px;
    }

    /* å´é‚Šä¸‹è¼‰æ¬„ */
    .download-box {
      background-color: var(--primary-color);
      color: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .download-box h3 {
      margin-top: 0;
      font-size: 1.2em;
    }

    .download-box p {
      font-size: 0.9em;
      margin-bottom: 20px;
    }

    .app-store-button, .google-play-button {
      display: block;
      background-color: white;
      color: var(--primary-color);
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      text-decoration: none;
      font-weight: bold;
      transition: transform 0.2s;
    }

    .app-store-button:hover, .google-play-button:hover {
      transform: scale(1.05);
    }

    .qr-code-section {
      display: flex;
      justify-content: space-around;
      margin-top: 20px;
      gap: 10px;
    }

    .qr-code-item {
      text-align: center;
    }

    .qr-code-section img {
      width: 100px;
      height: 100px;
      background-color: white;
      border: 1px solid #fff;
      border-radius: 5px;
      padding: 8px;
    }

    .qr-label {
      display: block;
      font-size: 0.8em;
      margin-top: 5px;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .empty-state-text {
      font-size: 16px;
    }

    /* åœ°åœ–ç›¸é—œæ¨£å¼ */
    .map-container {
      display: none;
      width: 100%;
      height: 600px;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-bottom: 20px;
      position: relative;
    }

    .map-container.active {
      display: block;
    }

    #store-map {
      width: 100%;
      height: 100%;
      border-radius: 5px;
    }

    .refresh-button {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .refresh-button:hover {
      background-color: #c62828;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    .refresh-button:active {
      transform: scale(0.95);
    }

    .map-status {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 10px;
      background: rgba(245, 245, 245, 0.95);
      border-top: 1px solid #ddd;
      font-size: 14px;
      color: #666;
    }

    .coupon-content {
      display: block;
    }

    .coupon-content.hidden {
      display: none;
    }

    /* æ¡Œé¢ç‰ˆ Bottom Info å€å¡Š - æ ¹æ“š Figma Desktop 1200 è¨­è¨ˆ */
    .bottom-info-section.desktop-bottom-info {
      display: block;
      padding: 0;
      max-width: 1400px;
      margin: 0 auto;
      width: 100%;
      height: 750px; /* æ ¹æ“š Figma height: 595px */
      position: relative;
      box-sizing: border-box;
    }

    /* æ‰‹æ©Ÿç‰ˆ Bottom Info å€å¡Šï¼ˆé è¨­éš±è—ï¼‰ */
    .bottom-info-section.mobile-bottom-info {
      display: none;
    }

    .bottom-info-card {
      position: relative;
      border-radius: 30px; /* å¾ 12px æ”¹ç‚º 30pxï¼Œæ ¹æ“š Figma image cornerRadius:30 */
      overflow: hidden;
      background: #ffffff;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      width: 100%;
      max-width: 1400px; /* æ ¹æ“š Figma image width: 1400px */
      height: 698px; /* æ ¹æ“š Figma image height: 554px */
      margin: 40px auto 0; /* æ°´å¹³ç½®ä¸­ */
      box-sizing: border-box;
    }

    .bottom-info-image {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 30px; /* æ ¹æ“š Figma cornerRadius:30 */
    }

    /* ä¸‹è¼‰æŒ‰éˆ•è¦†è“‹åœ¨åœ–ç‰‡è£¡é¢ - æ ¹æ“š Figma: google_play x:68, y:1854, app_store x:264, y:1854 */
    /* ç›¸å°æ–¼ image (x:33, y:1413): google_play x:68-33=35, y:1854-1413=441, app_store x:264-33=231, y:1854-1413=441 */
    .bottom-info-downloads {
      position: absolute;
      left: 125px; /* google_play ç›¸å°æ–¼ image x:35px */
      bottom: 113px; /* image height 554 - (button y 1854 - image y 1413) = 554 - 441 = 113px */
      display: flex;
      gap: 28px; /* app_store x:231 - google_play x:35 - google_play width 168 = 28px */
      padding: 0;
      box-sizing: border-box;
      pointer-events: none; /* å®¹å™¨æœ¬èº«ä¸åƒé»æ“Šï¼Œåªè®“è£¡é¢çš„æŒ‰éˆ•åƒ */
    }

    .bottom-info-downloads a {
      width: 168px; /* æ ¹æ“š Figma: å…©å€‹æŒ‰éˆ•éƒ½æ˜¯ 168px */
      height: 56px; /* æ ¹æ“š Figma: å…©å€‹æŒ‰éˆ•éƒ½æ˜¯ 56px */
      pointer-events: auto;
      display: block;
    }

    .bottom-info-downloads img {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    @media (max-width: 900px) {
      /* æ‰‹æ©Ÿç‰ˆ - æ ¹æ“š Figma Mobile 390 è¨­è¨ˆ */
      .header-section {
        background: transparent;
        padding: 0;
        height: 134px;
        position: relative;
        overflow: visible;
        border-bottom: none;
        box-shadow: none;
      }

      /* #ffebed èƒŒæ™¯åªåˆ° 96px */
      .header-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        width: 100%;
        height: 96px;
        background: #ffebed;
        z-index: 0;
      }

      .header-content {
        max-width: 390px;
        margin: 0 auto;
        width: 100%;
        height: 134px;
        position: relative;
        padding: 0;
        z-index: 1;
      }

      /* éš±è—æ¡Œé¢ç«¯å…ƒç´  */
      .header-content > .logo-box:first-child,
      .header-content > .main-title:not(.mobile-title),
      .header-top-row {
        display: none !important;
      }

      /* æ‰‹æ©Ÿç‰ˆ Logo - Figma: x:13, y:16, 62x63 */
      .mobile-logo {
        position: absolute;
        left: 13px;
        top: 16px;
        width: 62px;
        height: 63px;
        display: block !important;
        border-radius: 12px;
        overflow: hidden;
        background: #d9d9d9;
        z-index: 5;
      }

      .mobile-logo img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        display: block;
      }

      /* æ¨™é¡Œ "æ—¥æœ¬å„ªæƒ åˆ¸" - Figma: x:84, y:20, w:150, h:36 */
      .mobile-title {
        display: block;
        position: absolute;
        left: 90px;
        top: 20px;
      }

      .mobile-title h1 {
        font-size: 30px;
        font-weight: 700;
        color: #422826;
        margin: 0;
        line-height: 36px;
        width: 150px;
        height: 36px;
        font-family: 'Inter', 'Arial', 'Microsoft JhengHei', sans-serif;
      }

      /* å“ç‰Œ "JUNLANDO" - Figma: x:155, y:61, w:79, h:17 */
      .mobile-title h2 {
        position: absolute;
        left: 65px; /* 155 - 84 = 71 (ç›¸å°æ–¼ mobile-title) */
        top: 41px; /* 61 - 20 = 41 (ç›¸å°æ–¼ mobile-title) */
        font-size: 14px;
        font-weight: 500;
        color: #422826;
        margin: 0;
        line-height: 17px;
        width: 79px;
        height: 17px;
        font-family: 'Inter', 'Arial', 'Microsoft JhengHei', sans-serif;
      }

      /* å‰¯æ¨™é¡Œ - Figma: x:32, y:110, w:327, h:24, 20px, Medium, #605353 */
      .header-subtitle-section {
        display: block !important;
        position: absolute;
        left: 32px;
        top: 110px;
        z-index: 5;
        width: 327px;
        border: none;
        box-shadow: none;
      }

      .header-subtitle-section .subtitle-title {
        font-size: 20px;
        font-weight: 500;
        color: #605353;
        line-height: 24px;
        font-family: 'Inter', 'Arial', 'Microsoft JhengHei', sans-serif;
        margin: 0;
        padding: 0;
        display: block;
        width: 327px;
        height: 24px;
        border: none;
        box-shadow: none;
      }

      /* ç§»é™¤å‰¯æ¨™é¡Œæè¿°ï¼ˆFigma ä¸­æ²’æœ‰ï¼‰ */
      .header-subtitle-section .subtitle-description {
        display: none;
      }

      /* ä¸‹è¼‰æŒ‰éˆ• - æ ¹æ“šæœ€æ–° Figma æ•¸æ“š: x:257, y:20, 108x45, åœ“è§’12, é‚Šæ¡† #E1685F */
      .desktop-download-section {
        position: absolute;
        left: 275px;
        top: 25px;
        display: block !important;
        z-index: 10;
      }

      .download-box-wrapper {
        position: relative;
        width: 92px;
        height: 45px;
        border: 4px solid #E1685F;
        border-radius: 12px;
        background: #fff2f2;
        padding: 0;
        display: block;
        box-sizing: border-box;
        text-decoration: none;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .download-box-wrapper:hover {
        transform: scale(1.02);
        box-shadow: 0 2px 8px rgba(225, 104, 95, 0.3);
      }

      .download-box-wrapper:active {
        transform: scale(0.98);
      }

      /* ä¸‹è¼‰æ–‡å­— - æ ¹æ“šæœ€æ–° Figma æ•¸æ“š: x:271, y:34, 81x19, 16px, Semi Bold */
      /* æ–‡å­—åœ¨æŒ‰éˆ•å…§çš„ç›¸å°ä½ç½®: 271-257=14, 34-20=14 */
      .download-label {
        position: absolute;
        left: 10px; /* 271 - 257 = 14 */
        top: 10px; /* 34 - 20 = 14 */
        font-size: 16px;
        font-weight: 600;
        color: #E1685F;
        line-height: 19px;
        font-family: 'Inter', 'Arial', 'Microsoft JhengHei', sans-serif;
        margin: 0;
        padding: 0;
        white-space: nowrap;
        width: 81px;
        height: 19px;
        display: block;
      }

      .download-icons {
        display: none; /* æ‰‹æ©Ÿç‰ˆéš±è—åœ–æ¨™ */
      }
      
      /* æ¡Œé¢ç‰ˆéš±è—æ‰‹æ©Ÿç‰ˆ Logo */
      .mobile-logo {
        display: none;
      }

      /* é¡¯ç¤ºç§»å‹•ç«¯ä¸‹è¼‰æŒ‰éˆ•å€åŸŸ */
      .header-top-row {
        display: none; /* ä½¿ç”¨æ–°çš„å¸ƒå±€ï¼Œéš±è—èˆŠçš„ */
      }

      .mobile-download-buttons {
        display: none;
      }

      .container {
        flex-direction: column;
        padding: 0;
        max-width: 100%;
      }

      .main-content {
        width: 100%;
        padding: 0;
      }

      /* Coupon åˆ—è¡¨ä¿ç•™å·¦å³ padding å¢åŠ ä¸Šæ–¹padding*/
      .coupon-list {
        padding: 12px 24px 0 24px;
      }

      /* æ‰‹æ©Ÿç‰ˆéš±è—æ¡Œé¢ç‰ˆå´é‚Šä¸‹è¼‰å€ï¼ˆä¸‹è¼‰ App éš¨æ™‚éš¨åœ°ç²å–æŠ˜æ‰£...ï¼‰ */
      .sidebar {
        display: none;
      }

      /* æ‰‹æ©Ÿç‰ˆ Bottom Info å€å¡Š */
      .bottom-info-section.desktop-bottom-info {
        display: none; /* æ‰‹æ©Ÿç‰ˆéš±è—æ¡Œé¢ç‰ˆ */
      }

      .bottom-info-section.mobile-bottom-info {
        display: block; /* æ‰‹æ©Ÿç‰ˆé¡¯ç¤ºæ‰‹æ©Ÿç‰ˆ */
        padding: 16px 16px 70px;
      }

      /* æ‰‹æ©Ÿç‰ˆ Coupon Card - æ ¹æ“š Figma Mobile 390 è¨­è¨ˆ */
      .coupon-card {
        width: 100%;
        border-radius: 0;
        margin-bottom: 16px;
        background: #fff;
        border: 1px solid #e0e0e0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      }

      .coupon-card-inner {
        background: #fff;
      }

      /* æ‰‹æ©Ÿç‰ˆï¼šæœ‰åœ–æª”çš„ Coupon Card - ç›´æ¥é¡¯ç¤ºåœ–æª”ï¼ˆä¸ç¹ªè£½å¡ç‰‡ï¼‰ */
      .coupon-card.has-image {
        padding: 0;
        border: none;
        box-shadow: none;
        background: transparent;
        margin-bottom: 16px;
      }

      .coupon-card.has-image .coupon-image {
        width: 100%;
        height: auto;
        display: block;
        border-radius: 0;
        cursor: pointer;
      }

      .coupon-header {
        padding: 12px 16px;
        background: #fff5f5;
        border-bottom: 1px solid #ffe0e0;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .coupon-logo {
        width: 56px;
        height: 56px;
        border-radius: 10px;
        flex-shrink: 0;
      }

      .coupon-title {
        font-size: 20px;
        font-weight: 700;
        color: #333;
        flex: 1;
        line-height: 1.4;
      }

      .coupon-status {
        background-color: #0080FF;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        color: white;
        font-weight: 600;
        white-space: nowrap;
        flex-shrink: 0;
      }

      .coupon-details {
        padding: 16px;
        display: flex;
        align-items: flex-start;
        gap: 12px;
      }

      .discount-badge {
        background-color: #e53935;
        color: white;
        font-size: 32px;
        font-weight: 700;
        padding: 12px 16px;
        border-radius: 8px;
        min-width: 90px;
        text-align: center;
        flex-shrink: 0;
        line-height: 1.2;
      }

      .coupon-info {
        flex: 1;
        font-size: 14px;
        color: #555;
        line-height: 1.5;
      }

      .coupon-info strong {
        display: block;
        color: #e53935;
        font-size: 15px;
        font-weight: 600;
        margin-bottom: 6px;
      }

      .coupon-info small {
        display: block;
        color: #999;
        font-size: 13px;
        margin-top: 4px;
      }

      /* æ‰‹æ©Ÿç‰ˆ Filter å€åŸŸ - æ ¹æ“š Figma é‡æ–°è¨­è¨ˆ */
      .main-content {
        padding: 0;
      }

      /* æ¸›å°‘ navigation å’Œ filter ä¹‹é–“çš„è·é›¢ */
      .main-nav {
        margin-bottom: 0;
      }

      .filter-bar {
        background-color: transparent;
        padding: 0;
        margin: 0;
        margin-top: -10px; /* æ¸›å°‘èˆ‡ navigation çš„è·é›¢ */
        margin-bottom: 0;
        border-radius: 0;
        border: none;
        width: 100vw;
        max-width: 100vw;
        position: relative;
        overflow: hidden;
        margin-left: calc(-50vw + 50%);
        margin-right: calc(-50vw + 50%);
        left: 0;
        right: 0;
      }

      /* #e75e51 èƒŒæ™¯è¦†è“‹å…¨å¯¬ï¼Œåªåˆ° search bar å€åŸŸ - Figma: é«˜åº¦65px */
      .filter-bar::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        width: 100%;
        height: 65px;
        background-color: #e75e51;
        z-index: 0;
      }

      /* Search bar åœ¨ä¸Šæ–¹ - Figma: è¼¸å…¥æ¡† x:13, y:12, 283x40, æŒ‰éˆ• x:296, y:12, 80x40 */
      .search-container {
        position: relative;
        z-index: 1;
        display: flex;
        gap: 0;
        margin: 12px 13px;
        width: calc(100% - 26px);
        max-width: 390px;
        margin-left: auto;
        margin-right: auto;
      }

      .search-container input {
        width: 283px;
        height: 40px;
        font-size: 16px;
        padding: 0 16px;
        border: none;
        border-radius: 10px 0 0 10px; /* å·¦ä¸Šå·¦ä¸‹åœ“è§’10 */
        background: #ffffff;
        color: #333;
        box-sizing: border-box;
      }

      .search-container input::placeholder {
        color: #b3b3b3;
        font-size: 16px;
        font-weight: 400;
      }

      .search-container button {
        width: 80px;
        height: 40px;
        background-color: #ffa94d;
        color: #ffffff;
        border: none;
        border-radius: 0 10px 10px 0; /* å³ä¸Šå³ä¸‹åœ“è§’10 */
        font-size: 16px;
        font-weight: 700;
        padding: 0;
        white-space: nowrap;
        cursor: pointer;
        transition: background-color 0.2s;
        margin-left: 0;
      }

      .search-container button:hover {
        background-color: #ff9800;
      }

      /* Category tabs åœ¨ä¸‹æ–¹ - Figma: y:65, é«˜åº¦39px, å¯å·¦å³æ»‘å‹•, èˆ‡ search bar æœ‰é–“è· */
      .category-tabs {
        position: relative;
        z-index: 1;
        display: flex;
        flex-wrap: nowrap;
        overflow-x: auto;
        overflow-y: hidden;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE and Edge */
        gap: 0;
        margin-top: 0;
        padding-top: 0;
        padding-bottom: 0;
        padding-left: 0;
        padding-right: 0;
        margin-left: 0;
        margin-right: 0;
        width: 100%;
      }

      /* éš±è—æ»¾å‹•æ¢ä½†ä¿æŒæ»¾å‹•åŠŸèƒ½ */
      .category-tabs::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera */
      }

      .category-tab {
        flex-shrink: 0;
        height: 39px;
        min-width: auto;
        width: auto;
        padding: 0 16px;
        white-space: nowrap;
        font-size: 16px;
        font-weight: 400;
        font-family: 'Inter', 'Arial', 'Microsoft JhengHei', sans-serif;
        border: 1px solid #e75e51;
        border-radius: 0;
        background: #ffebed;
        color: #e75e51;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        margin-right: 0;
        box-sizing: border-box;
      }

      /* Tab é¸ä¸­ç‹€æ…‹ - èƒŒæ™¯ #e75e51, å­—ç™½è‰² */
      .category-tab.active {
        background-color: #e75e51;
        color: #ffffff;
        border: 1px solid #e75e51;
      }

      /* Tab æœªé¸ä¸­ç‹€æ…‹ - èƒŒæ™¯ #ffebed, å­— #e75e51, é‚Šæ¡† #e75e51 */
      .category-tab:not(.active) {
        background-color: #ffebed;
        color: #e75e51;
        border: 1px solid #e75e51;
      }

      .category-tab:hover {
        opacity: 0.9;
      }
    }
  </style>
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getAnalytics, logEvent } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyDOc1-a54mn3BCZzAhol5o7tJ-TH72uA1A",
      authDomain: "couponweb-fc6f9.firebaseapp.com",
      projectId: "couponweb-fc6f9",
      storageBucket: "couponweb-fc6f9.firebasestorage.app",
      messagingSenderId: "833095007382",
      appId: "1:833095007382:web:10aca346a680ce9947d6b7",
      measurementId: "G-VGPEQDL1RH"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    
    // å°† analytics å’Œ logEvent æš´éœ²åˆ°å…¨å±€ï¼Œä¾›å…¶ä»–è„šæœ¬ä½¿ç”¨
    window.analytics = analytics;
    window.logEvent = logEvent;
  </script>
</head>
<body>
  <header class="header-section">
    <div class="header-content">
      <!-- æ¡Œé¢ç«¯å¸ƒå±€ï¼šlogo å’Œæ ‡é¢˜åœ¨åŒä¸€è¡Œ -->
      <div class="logo-box">
        <img src="drawables/net_icon.png" alt="COUPON" />
      </div>
      <div class="main-title">
        <h1>æ—¥æœ¬å„ªæƒ åˆ¸</h1>
        <h2>JUNLANDO</h2>
      </div>
      <!-- ç§»åŠ¨ç«¯å¸ƒå±€ï¼šlogo å’Œä¸‹è½½æŒ‰é’®åœ¨ç¬¬ä¸€è¡Œï¼Œæ ‡é¢˜åœ¨ç¬¬äºŒè¡Œ -->
      <div class="header-top-row">
        <div class="logo-box">
          <img src="drawables/net_icon.png" alt="COUPON" />
        </div>
        <div class="mobile-download-buttons">
          <span class="mobile-download-label">æ‰‹æ©Ÿç‰ˆä¸‹è¼‰</span>
          <div style="display: flex; gap: 8px; align-items: center;">
            <a href="https://apps.apple.com/tw/app/%E6%97%A5%E6%9C%AC%E5%84%AA%E6%83%A0%E5%88%B8-2025-%E6%97%A5%E6%9C%AC%E8%B3%BC%E7%89%A9-%E6%97%85%E9%81%8A%E5%BF%85%E5%82%99-%E6%97%A5%E5%B9%A3%E6%8F%9B%E7%AE%97/id6449156306" 
               target="_blank" 
               rel="noopener noreferrer"
               class="mobile-download-btn">
              <img src="drawables/app_store_icon.png" alt="App Store" />
            </a>
            <a href="https://play.google.com/store/apps/details?id=com.junlando.japancoupon" 
               target="_blank" 
               rel="noopener noreferrer"
               class="mobile-download-btn">
              <img src="drawables/google_play_icon.png" alt="Google Play" />
            </a>
          </div>
        </div>
      </div>
      <!-- æ‰‹æ©Ÿç‰ˆ Logo -->
      <div class="mobile-logo">
        <img src="drawables/net_icon.png" alt="COUPON" />
      </div>
      <!-- æ‰‹æ©Ÿç‰ˆæ¨™é¡Œ - æ ¹æ“š Figma Mobile 390 -->
      <div class="main-title mobile-title">
        <h1>æ—¥æœ¬å„ªæƒ åˆ¸</h1>
        <h2>JUNLANDO</h2>
      </div>
      <!-- æ‰‹æ©Ÿç‰ˆå‰¯æ¨™é¡Œå€å¡Š -->
      <div class="header-subtitle-section">
        <div class="subtitle-title">2025 è¶…é40é–“æ—¥æœ¬å„ªæƒ åˆ¸æ•´ç† è³¼ç‰©æ—…éŠå¿…å‚™! </div>
      </div>
      <!-- æ¡Œé¢ç‰ˆä¸‹è¼‰æŒ‰éˆ• - æ ¹æ“š Figma Desktop 1200 -->
      <div class="desktop-download-section">
        <div class="download-box-wrapper">
          <a href="https://play.google.com/store/apps/details?id=com.junlando.japancoupon" 
             target="_blank" 
             rel="noopener noreferrer"
             class="download-icon-btn google-play"
             id="desktop-google-play-link">
            <img src="/google_play_downnload.png" alt="Google Play" />
          </a>
          <a href="https://apps.apple.com/tw/app/%E6%97%A5%E6%9C%AC%E5%84%AA%E6%83%A0%E5%88%B8-2025-%E6%97%A5%E6%9C%AC%E8%B3%BC%E7%89%A9-%E6%97%85%E9%81%8A%E5%BF%85%E5%82%99-%E6%97%A5%E5%B9%A3%E6%8F%9B%E7%AE%97/id6449156306" 
             target="_blank" 
             rel="noopener noreferrer"
             class="download-icon-btn app-store"
             id="desktop-app-store-link">
            <img src="/app_store_download.png" alt="App Store" />
          </a>
        </div>
      </div>
    </div>
  </header>

  <nav class="main-nav">
    <ul>
      <li class="nav-tab active" data-tab="coupons">å„ªæƒ åˆ¸</li>
      <li class="nav-tab" data-tab="map">é™„è¿‘å•†å®¶åœ°åœ–</li>
    </ul>
  </nav>

  <div class="container">
    <main class="main-content">
      <!-- å„ªæƒ åˆ¸å…§å®¹ -->
      <div class="coupon-content" id="coupon-content">
      <section class="filter-bar">
        <!-- Search bar åœ¨ä¸Šæ–¹ -->
        <div class="search-container">
          <input type="text" id="search-input" placeholder="æœå°‹å„ªæƒ åˆ¸" />
          <button onclick="filterCoupons()">æœå°‹</button>
        </div>
        <!-- Category tabs åœ¨ä¸‹æ–¹ - å‹•æ…‹ç”Ÿæˆ -->
        <div class="category-tabs" id="category-filters">
          <!-- Category tabs å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
        </div>
      </section>

      <section class="coupon-list" id="coupon-list">
        <div class="empty-state">
          <div class="empty-state-icon">ğŸ“‹</div>
          <div class="empty-state-text">è¼‰å…¥ä¸­...</div>
        </div>
      </section>

      <!-- Desktop Bottom Info å€å¡Šï¼ˆåƒ…æ¡Œé¢ç‰ˆé¡¯ç¤ºï¼‰ -->
      <section class="bottom-info-section desktop-bottom-info">
        <div class="bottom-info-card">
          <img
            src="drawables/bottom_info_desktop.png"
            alt="æ›´å¤šæ—¥æœ¬å„ªæƒ åˆ¸èˆ‡APPè³‡è¨Š"
            class="bottom-info-image"
          />
          <div class="bottom-info-downloads">
            <a
              href="https://play.google.com/store/apps/details?id=com.junlando.japancoupon"
              target="_blank"
              rel="noopener noreferrer"
              id="desktop-bottom-google-play-link"
            >
              <img
                src="/google_play_downnload.png"
                alt="Google Play ä¸‹è¼‰"
              />
            </a>
            <a
              href="https://apps.apple.com/tw/app/%E6%97%A5%E6%9C%AC%E5%84%AA%E6%83%A0%E5%88%B8-2025-%E6%97%A5%E6%9C%AC%E8%B3%BC%E7%89%A9-%E6%97%85%E9%81%8A%E5%BF%85%E5%82%99-%E6%97%A5%E5%B9%A3%E6%8F%9B%E7%AE%97/id6449156306"
              target="_blank"
              rel="noopener noreferrer"
              id="desktop-bottom-app-store-link"
            >
              <img
                src="/app_store_download.png"
                alt="App Store ä¸‹è¼‰"
              />
            </a>
          </div>
        </div>
      </section>

      <!-- Mobile Bottom Info å€å¡Šï¼ˆåƒ…æ‰‹æ©Ÿç‰ˆé¡¯ç¤ºï¼Œåƒè€ƒ Mobile 390 è¨­è¨ˆï¼‰ -->
      <section class="bottom-info-section mobile-bottom-info">
        <div class="bottom-info-card">
          <img
            src="drawables/bottom_info.png"
            alt="æ›´å¤šæ—¥æœ¬å„ªæƒ åˆ¸èˆ‡APPè³‡è¨Š"
            class="bottom-info-image"
          />
          <div class="bottom-info-downloads">
            <a
              href="https://apps.apple.com/tw/app/%E6%97%A5%E6%9C%AC%E5%84%AA%E6%83%A0%E5%88%B8-2025-%E6%97%A5%E6%9C%AC%E8%B3%BC%E7%89%A9-%E6%97%85%E9%81%8A%E5%BF%85%E5%82%99-%E6%97%A5%E5%B9%A3%E6%8F%9B%E7%AE%97/id6449156306"
              target="_blank"
              rel="noopener noreferrer"
              id="bottom-app-store-link"
            >
              <img
                src="/app_store_download.png"
                alt="App Store ä¸‹è¼‰"
              />
            </a>
            <a
              href="https://play.google.com/store/apps/details?id=com.junlando.japancoupon"
              target="_blank"
              rel="noopener noreferrer"
              id="bottom-google-play-link"
            >
              <img
                src="/google_play_downnload.png"
                alt="Google Play ä¸‹è¼‰"
              />
            </a>
          </div>
        </div>
      </section>
      </div>

      <!-- åœ°åœ–å…§å®¹ -->
      <div class="coupon-content hidden" id="map-content">
        <div class="map-container active" id="map-container">
          <div id="store-map"></div>
            <button class="refresh-button" id="refresh-map-btn" onclick="refreshMapMarkers()">æœç´¢é™„è¿‘å€åŸŸ</button>
          <div class="map-status">
            <span id="map-status-text">åœ°åœ–è¼‰å…¥ä¸­...</span>
          </div>
        </div>
      </div>
    </main>

    <aside class="sidebar">
      <div class="download-box">
        <h3>ä¸‹è¼‰ App</h3>
        <p>éš¨æ™‚éš¨åœ°ç²å–æŠ˜æ‰£ï¼Œå†ä¹Ÿä¸ç”¨æ“”å¿ƒéŒ¯éä¸‹è¼‰é€£çµï¼</p>
        <a href="#" class="app-store-button" id="sidebar-app-store-link" target="_blank">App Store</a>
        <a href="https://play.google.com/store/apps/details?id=com.junlando.japancoupon" class="google-play-button" id="sidebar-google-play-link" target="_blank">Google Play</a>
        
        <div class="qr-code-section">
          <div class="qr-code-item">
            <img src="drawables/ios_qrcode.png" alt="iOS ä¸‹è¼‰ QR Code" />
            <span class="qr-label">iOS ä¸‹è¼‰</span>
          </div>
          <div class="qr-code-item">
            <img src="drawables/android_qrcode.png" alt="Android ä¸‹è¼‰ QR Code" />
            <span class="qr-label">Android ä¸‹è¼‰</span>
          </div>
        </div>
      </div>
    </aside>
  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script>
    // App Store é€£çµ
    const APP_STORE_URL = 'https://apps.apple.com/tw/app/%E6%97%A5%E6%9C%AC%E5%84%AA%E6%83%A0%E5%88%B8-2025-%E6%97%A5%E6%9C%AC%E8%B3%BC%E7%89%A9-%E6%97%85%E9%81%8A%E5%BF%85%E5%82%99-%E6%97%A5%E5%B9%A3%E6%8F%9B%E7%AE%97/id6449156306';
    const GOOGLE_PLAY_URL = 'https://play.google.com/store/apps/details?id=com.junlando.japancoupon';

    let coupons = [];
    let filteredCoupons = [];
    let currentCategory = 'all';
    let searchQuery = '';

    // åˆ†é¡åç¨±å°æ‡‰
    // åˆ†é¡åç¨±å°æ‡‰
    const categoryNames = {
      all: 'å…¨éƒ¨',
      drugstoreAndDaily: 'è—¥å¦',
      electronics: 'é›»å™¨',
      departmentStore: 'ç™¾è²¨',
      airportDutyFree: 'æ©Ÿå ´',
      fashion: 'æœé£¾é…ä»¶',
      sports: 'é‹å‹•',
      animeAndGoods: 'å‹•æ¼«',
      online: 'ç·šä¸Š'
    };

    // å‹•æ…‹ç”Ÿæˆ Category Tabs
    function generateCategoryTabs() {
      // å¾ coupons ä¸­æå–æ‰€æœ‰å”¯ä¸€çš„ category é¡å‹
      const categories = new Set();
      coupons.forEach(coupon => {
        if (coupon.type) {
          categories.add(coupon.type);
        }
      });

      // æ’åº categoryï¼ˆå¯é¸ï¼Œè®“é †åºæ›´ä¸€è‡´ï¼‰
      const sortedCategories = Array.from(categories).sort();

      // ç”Ÿæˆ category tabs HTML
      const categoryFiltersEl = document.getElementById('category-filters');
      let tabsHTML = '<button class="category-tab active" data-category="all">å…¨éƒ¨</button>';
      
      sortedCategories.forEach(category => {
        const categoryName = categoryNames[category] || category;
        tabsHTML += `<button class="category-tab" data-category="${category}">${categoryName}</button>`;
      });

      categoryFiltersEl.innerHTML = tabsHTML;
    }

    // è¼‰å…¥å„ªæƒ åˆ¸è³‡æ–™
    async function loadCoupons() {
      try {
        const response = await fetch('coupons.json');
        coupons = await response.json();
        filteredCoupons = [...coupons];
        
        // å‹•æ…‹ç”Ÿæˆ category tabs
        generateCategoryTabs();
        
        renderCoupons();
      } catch (error) {
        console.error('è¼‰å…¥å„ªæƒ åˆ¸å¤±æ•—:', error);
        document.getElementById('coupon-list').innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">âŒ</div>
            <div class="empty-state-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>
          </div>
        `;
      }
    }

    // æ ¼å¼åŒ–æˆªæ­¢æ—¥æœŸ
    function formatDeadline(timestamp) {
      if (!timestamp) return 'ç„¡é™æœŸ';
      const date = new Date(timestamp * 1000);
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `æˆªæ­¢æ—¥æœŸ: ${year}/${month}/${day}`;
    }

    // ç²å–åœ–æ¨™è·¯å¾‘
    function getIconPath(imageName) {
      const iconMap = {
        'donki': 'donki.jpeg',
        'matsu': 'matsu.png',
        'big_camera': 'big_camera.png',
        'daikoku': 'daikoku.jpg',
        'sapporo': 'sapporo.jpeg',
        'daimaru': 'daimaru.png',
        'victoria': 'victoria.png',
        'mitsui': 'mitsui.png',
        'edion': 'edion.png',
        'duty_free': 'duty_free.png',
        'aeon': 'aeon.png',
        'aeon_mall': 'aeon_mall.png',
        'tsuruha': 'tsuruha.png',
        'keio': 'keio.png',
        'sundrug': 'sundrug.jpeg',
        'tobu': 'tobu.png',
        'cosmos': 'cosmos.png',
        'cosmetics': 'cosmetics.png',
        'takeya': 'takeya.png',
        'sanrio': 'sanrio.jpg',
        'yamadalabi': 'yamadalabi.png',
        'alpen_tokyo': 'alpen_tokyo.png',
        'laox': 'laox.png',
        'gu': 'gu.png',
        'sugi': 'sugi.png',
        'ana': 'ana.png',
        'new1': 'new1.jpg',
        'west': 'west.png',
        'kokumin': 'kokumin.jpg',
        'cocokarafine': 'cocokarafine.png',
        'odakyu': 'odakyu.jpg',
        'aoki': 'aoki.png',
        'orihica': 'orihica.png',
        'wamazing': 'wamazing.png',
        'fasola': 'fasola.png',
        'snowpeak': 'snowpeak.png',
        'jungle': 'jungle.png',
        'briefing': 'briefing.png',
        'aoyama': 'aoyama.png',
        'paris': 'paris.jpeg',
        'ohga': 'ohga.png',
        'meitetsu': 'meitetsu.png',
        'lotte': 'lotte.jpeg'
      };
      
      const fileName = iconMap[imageName] || `${imageName}.png`;
      return `store_icons/${fileName}`;
    }

    // ç²å–å„ªæƒ åˆ¸åœ–ç‰‡è·¯å¾‘
    function getCouponImagePath(imageURL) {
      if (!imageURL) return null;
      if (imageURL.endsWith('.pdf')) {
        return `coupon_images/${imageURL.replace('.pdf', '.jpg')}`;
      }
      return `coupon_images/${imageURL}`;
    }

    // è™•ç†å„ªæƒ åˆ¸é»æ“Š
    function handleCouponClick(coupon) {
      // ç™¼é€ Firebase Analytics äº‹ä»¶
      if (window.logEvent && window.analytics) {
        const couponName = coupon.imageName || coupon.title || 'unknown';
        const eventName = `coupon_${couponName}_click`;
        try {
          window.logEvent(window.analytics, eventName, {
            coupon_title: coupon.title
          });
        } catch (error) {
          console.warn('Firebase Analytics äº‹ä»¶ç™¼é€å¤±æ•—:', error);
        }
      }
      
      if (coupon.link) {
        window.open(coupon.link, '_blank');
      } else if (coupon.imageURL) {
        const imagePath = getCouponImagePath(coupon.imageURL);
        if (imagePath) {
          const newWindow = window.open('', '_blank');
          newWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
              <title>${coupon.title} - å„ªæƒ åˆ¸</title>
              <meta name="viewport" content="width=device-width, initial-scale=1">
              <style>
                body {
                  margin: 0;
                  padding: 20px;
                  background: #f5f5f5;
                  display: flex;
                  justify-content: center;
                  align-items: center;
                  min-height: 100vh;
                }
                img {
                  max-width: 100%;
                  height: auto;
                  border-radius: 8px;
                  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                }
              </style>
            </head>
            <body>
              <img src="${imagePath}" alt="${coupon.title}" onerror="this.parentElement.innerHTML='<p>åœ–ç‰‡è¼‰å…¥å¤±æ•—</p>'" />
            </body>
            </html>
          `);
        }
      }
    }

    // ç²å– coupon_store ä¸­çš„åœ–ç‰‡è·¯å¾‘ï¼ˆæ ¹æ“š imageNameï¼‰
    function getCouponStoreImagePath(imageName) {
      if (!imageName) return null;
      
      // imageName åˆ° coupon_store æª”åçš„å°æ‡‰é—œä¿‚
      // å¦‚æœ imageName å’Œæª”åä¸ä¸€è‡´ï¼Œéœ€è¦å»ºç«‹æ˜ å°„
      const storeImageMap = {
        'big_camera': 'biccamera.png',
        'new1': 'new.png',
        // å…¶ä»–å¤§éƒ¨åˆ† imageName ç›´æ¥å°æ‡‰åˆ° {imageName}.png
      };
      
      // å¦‚æœæœ‰æ˜ å°„ï¼Œä½¿ç”¨æ˜ å°„çš„æª”åï¼›å¦å‰‡ä½¿ç”¨ {imageName}.png
      const storeFileName = storeImageMap[imageName] || `${imageName}.png`;
      
      return `coupon_store/${storeFileName}`;
    }

    // æ¸²æŸ“å„ªæƒ åˆ¸åˆ—è¡¨
    function renderCoupons() {
      const listEl = document.getElementById('coupon-list');
      
      if (filteredCoupons.length === 0) {
        listEl.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ”</div>
            <div class="empty-state-text">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„å„ªæƒ åˆ¸</div>
          </div>
        `;
        return;
      }

      // æª¢æŸ¥æ˜¯å¦ç‚ºæ‰‹æ©Ÿç‰ˆ
      const isMobile = window.innerWidth <= 900;

      listEl.innerHTML = filteredCoupons.map((coupon, index) => {
        // æ‰‹æ©Ÿç‰ˆå’Œæ¡Œé¢ç‰ˆéƒ½ç›´æ¥ä½¿ç”¨ coupon_store ä¸­çš„åœ–æª”
        const imagePath = getCouponStoreImagePath(coupon.imageName);
        const couponData = JSON.stringify(coupon).replace(/"/g, '&quot;');
        return `
          <div class="coupon-card has-image" data-coupon-index="${index}" onclick="handleCouponClick(${couponData})">
            <img src="${imagePath}" alt="${coupon.title}" class="coupon-image" onerror="handleCouponImageError(this)" />
          </div>
        `;
      }).join('');

      // æ·»åŠ é»æ“Šäº‹ä»¶
      listEl.querySelectorAll('.coupon-card').forEach((card, index) => {
        card.addEventListener('click', () => {
          handleCouponClick(filteredCoupons[index]);
        });
      });
    }

    // ç¯©é¸å„ªæƒ åˆ¸
    function filterCoupons() {
      filteredCoupons = coupons.filter(coupon => {
        if (currentCategory !== 'all' && coupon.type !== currentCategory) {
          return false;
        }
        
        if (searchQuery) {
          const query = searchQuery.toLowerCase();
          return coupon.title.toLowerCase().includes(query) ||
                 coupon.description.toLowerCase().includes(query);
        }
        
        return true;
      });
      
      renderCoupons();
    }

    // åˆ†é¡æŒ‰éˆ•é»æ“Šï¼ˆä½¿ç”¨äº‹ä»¶å§”æ‰˜ï¼Œæ”¯æ´å‹•æ…‹ç”Ÿæˆçš„å…ƒç´ ï¼‰
    document.getElementById('category-filters').addEventListener('click', (e) => {
      if (e.target.classList.contains('category-tab')) {
        document.querySelectorAll('.category-tab').forEach(btn => {
          btn.classList.remove('active');
        });
        e.target.classList.add('active');
        
        currentCategory = e.target.dataset.category;
        filterCoupons();
      }
    });

    // æœå°‹è¼¸å…¥
    document.getElementById('search-input').addEventListener('input', (e) => {
      searchQuery = e.target.value;
      filterCoupons();
    });

    // è™•ç†å„ªæƒ åˆ¸é»æ“Šï¼ˆå…¨åŸŸå‡½æ•¸ï¼‰
    window.handleCouponClick = function(coupon) {
      // ç™¼é€ Firebase Analytics äº‹ä»¶
      if (window.logEvent && window.analytics) {
        const couponName = coupon.imageName || coupon.title || 'unknown';
        const eventName = `coupon_${couponName}_click`;
        try {
          window.logEvent(window.analytics, eventName, {
            coupon_title: coupon.title
          });
        } catch (error) {
          console.warn('Firebase Analytics äº‹ä»¶ç™¼é€å¤±æ•—:', error);
        }
      }
      
      if (coupon.link) {
        window.open(coupon.link, '_blank');
      } else if (coupon.imageURL) {
        const imagePath = getCouponImagePath(coupon.imageURL);
        if (imagePath) {
          const newWindow = window.open('', '_blank');
          newWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
              <title>${coupon.title} - å„ªæƒ åˆ¸</title>
              <meta name="viewport" content="width=device-width, initial-scale=1">
              <style>
                body {
                  margin: 0;
                  padding: 20px;
                  background: #f5f5f5;
                  display: flex;
                  justify-content: center;
                  align-items: center;
                  min-height: 100vh;
                }
                img {
                  max-width: 100%;
                  height: auto;
                  border-radius: 8px;
                  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                }
              </style>
            </head>
            <body>
              <img src="${imagePath}" alt="${coupon.title}" onerror="this.parentElement.innerHTML='<p>åœ–ç‰‡è¼‰å…¥å¤±æ•—</p>'" />
            </body>
            </html>
          `);
        }
      }
    };

    // ================================
    // åœ°åœ–ç›¸é—œåŠŸèƒ½
    // ================================
    let storeMap = null;
    let storeMarkers = [];
    let userMarker = null;
    let allMarkersData = []; // æ‰€æœ‰å•†å®¶æ¨™è¨˜æ•¸æ“š
    const TOKYO_CENTER = [35.6762, 139.6503]; // æ±äº¬é»˜èªä½ç½®

    // Tab åˆ‡æ›
    function initTabs() {
      const tabs = document.querySelectorAll('.nav-tab');
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          // æ›´æ–° tab æ¨£å¼
          tabs.forEach(t => {
            t.classList.remove('active');
          });
          tab.classList.add('active');

          // åˆ‡æ›å…§å®¹
          const tabName = tab.dataset.tab;
          const couponContent = document.getElementById('coupon-content');
          const mapContent = document.getElementById('map-content');

          // ç™¼é€ Firebase Analytics äº‹ä»¶
          if (window.logEvent && window.analytics) {
            try {
              window.logEvent(window.analytics, `tab_${tabName}_click`, {
                tab_name: tabName
              });
            } catch (error) {
              console.warn('Firebase Analytics äº‹ä»¶ç™¼é€å¤±æ•—:', error);
            }
          }

          if (tabName === 'coupons') {
            couponContent.classList.remove('hidden');
            mapContent.classList.add('hidden');
          } else if (tabName === 'map') {
            couponContent.classList.add('hidden');
            mapContent.classList.remove('hidden');
            // ç¢ºä¿å…ƒç´ å¯è¦‹å¾Œå†åˆå§‹åŒ–åœ°åœ–
            setTimeout(() => {
              initMap();
            }, 100);
          }
        });
      });
    }

    // ç²å–ç”¨æˆ¶ä½ç½®
    function getUserLocation() {
      return new Promise((resolve) => {
        if (!navigator.geolocation) {
          resolve(TOKYO_CENTER);
          return;
        }

        navigator.geolocation.getCurrentPosition(
          (position) => {
            resolve([position.coords.latitude, position.coords.longitude]);
          },
          (error) => {
            console.log('ç„¡æ³•ç²å–ä½ç½®:', error);
            resolve(TOKYO_CENTER);
          },
          { timeout: 5000 }
        );
      });
    }

    // ç²å–å“ç‰Œåœ–æ¨™è·¯å¾‘
    function getBrandIconPath(brand) {
      const iconMap = {
        'donki': 'donki.jpeg',
        'matsu': 'matsu.png',
        'big_camera': 'big_camera.png',
        'daikoku': 'daikoku.jpg',
        'sapporo': 'sapporo.jpeg',
        'daimaru': 'daimaru.png',
        'victoria': 'victoria.png',
        'mitsui': 'mitsui.png',
        'edion': 'edion.png',
        'duty_free': 'duty_free.png',
        'aeon': 'aeon.png',
        'aeon_mall': 'aeon_mall.png',
        'tsuruha': 'tsuruha.png',
        'keio': 'keio.png',
        'sundrug': 'sundrug.jpeg',
        'tobu': 'tobu.png',
        'cosmos': 'cosmos.png',
        'cosmetics': 'cosmetics.png',
        'takeya': 'takeya.png',
        'yamadalabi': 'yamadalabi.png',
        'alphen_tokyo': 'alphen_tokyo.png',
        'laox': 'laox.png',
        'gu': 'gu.png',
        'sugi': 'sugi.png',
        'ana': 'ana.png',
        'new1': 'new1.jpg',
        'west': 'west.png',
        'kokumin': 'kokumin.jpg',
        'cocokarafine': 'cocokarafine.png',
        'odakyu': 'odakyu.jpg',
        'aoki': 'aoki.png',
        'orihica': 'orihica.png',
        'wamazing': 'wamazing.png',
        'fasola': 'fasola.png',
        'snowpeak': 'snowpeak.png',
        'jungle': 'jungle.png',
        'briefing': 'briefing.png',
        'aoyama': 'aoyama.png',
        'paris': 'paris.jpeg',
        'ohga': 'ohga.png',
        'meitetsu': 'meitetsu.png',
        'lotte': 'lotte.jpeg'
      };

      const fileName = iconMap[brand] || 'icon.png';
      return `store_icons/${fileName}`;
    }

    // åˆå§‹åŒ–åœ°åœ–
    async function initMap() {
      if (storeMap) {
        return; // åœ°åœ–å·²åˆå§‹åŒ–
      }

      const mapEl = document.getElementById('store-map');
      const statusEl = document.getElementById('map-status-text');

      if (!mapEl || !statusEl) {
        console.warn('åœ°åœ–å…ƒç´ æˆ–ç‹€æ…‹å…ƒç´ ä¸å­˜åœ¨');
        return;
      }

      statusEl.textContent = 'æ­£åœ¨è¼‰å…¥åœ°åœ–...';

      // ç²å–ç”¨æˆ¶ä½ç½®
      const userLocation = await getUserLocation();

      // åˆå§‹åŒ–åœ°åœ–
      storeMap = L.map('store-map').setView(userLocation, 15);

      // æ·»åŠ åœ°åœ–åœ–å±¤
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors',
        maxZoom: 18,
      }).addTo(storeMap);

      // æ·»åŠ ç”¨æˆ¶ä½ç½®æ¨™è¨˜
      const userIcon = L.divIcon({
        className: 'user-location-marker',
        html: '<div style="width: 20px; height: 20px; background: #4285f4; border: 3px solid white; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
        iconSize: [20, 20],
        iconAnchor: [10, 10]
      });

      userMarker = L.marker(userLocation, { icon: userIcon })
        .addTo(storeMap)
        .bindPopup('æ‚¨çš„ä½ç½®');

      // è¼‰å…¥æ‰€æœ‰å•†å®¶æ•¸æ“š
      await loadAllMarkersData();

      // è¼‰å…¥ç•¶å‰è¦–é‡ç¯„åœå…§çš„å•†å®¶æ¨™è¨˜
      await refreshMapMarkers();

      // ç›£è½åœ°åœ–ç§»å‹•å’Œç¸®æ”¾äº‹ä»¶ï¼ˆä½¿ç”¨é˜²æŠ–ï¼Œé¿å…é »ç¹åˆ·æ–°ï¼‰
      // æ³¨æ„ï¼šæš«æ™‚ä¸è‡ªå‹•åˆ·æ–°ï¼Œåªæä¾›æ‰‹å‹•åˆ·æ–°æŒ‰éˆ•ï¼Œé¿å…å¡é “
      // å¦‚æœéœ€è¦è‡ªå‹•åˆ·æ–°ï¼Œå¯ä»¥å–æ¶ˆä¸‹é¢çš„è¨»é‡‹
      /*
      storeMap.on('moveend', () => {
        if (window.isRefreshingMarkers) return;
        if (mapMoveTimeout) {
          clearTimeout(mapMoveTimeout);
        }
        mapMoveTimeout = setTimeout(() => {
          if (!window.isRefreshingMarkers) {
            refreshMapMarkers();
          }
        }, 1000); // é˜²æŠ–ï¼Œ1ç§’å¾Œæ‰åˆ·æ–°
      });

      storeMap.on('zoomend', () => {
        if (window.isRefreshingMarkers) return;
        if (mapMoveTimeout) {
          clearTimeout(mapMoveTimeout);
        }
        mapMoveTimeout = setTimeout(() => {
          if (!window.isRefreshingMarkers) {
            refreshMapMarkers();
          }
        }, 1000);
      });
      */
    }

    // è¼‰å…¥æ‰€æœ‰å•†å®¶æ•¸æ“šï¼ˆåªè¼‰å…¥ä¸€æ¬¡ï¼‰
    async function loadAllMarkersData() {
      if (allMarkersData && allMarkersData.length > 0) {
        return; // å·²ç¶“è¼‰å…¥é
      }

      try {
        const response = await fetch('markers.json');
        allMarkersData = await response.json();
      } catch (error) {
        console.error('è¼‰å…¥å•†å®¶æ•¸æ“šå¤±æ•—:', error);
        const statusEl = document.getElementById('map-status-text');
        if (statusEl) {
          statusEl.textContent = 'è¼‰å…¥å•†å®¶æ•¸æ“šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦';
        }
      }
    }

    // åˆ·æ–°åœ°åœ–æ¨™è¨˜ï¼ˆåªé¡¯ç¤ºç•¶å‰è¦–é‡ç¯„åœå…§çš„ï¼‰
    async function refreshMapMarkers() {
      if (!storeMap || allMarkersData.length === 0) {
        return;
      }

      // é˜²æ­¢é‡è¤‡åˆ·æ–°
      if (window.isRefreshingMarkers) {
        return;
      }
      window.isRefreshingMarkers = true;

      const statusEl = document.getElementById('map-status-text');
      if (statusEl) {
        statusEl.textContent = 'æ­£åœ¨è¼‰å…¥å•†å®¶ä½ç½®...';
      }

      // æ¸…é™¤ç¾æœ‰æ¨™è¨˜ï¼ˆæ‰¹é‡ç§»é™¤ï¼Œæé«˜æ€§èƒ½ï¼‰
      if (storeMarkers.length > 0) {
        // åˆ†æ‰¹ç§»é™¤ï¼Œé¿å…ä¸€æ¬¡æ€§ç§»é™¤å¤ªå¤šå°è‡´å¡é “
        const removeBatchSize = 100;
        for (let i = 0; i < storeMarkers.length; i += removeBatchSize) {
          const batch = storeMarkers.slice(i, i + removeBatchSize);
          batch.forEach(marker => {
            storeMap.removeLayer(marker);
          });
          // è®“ç€è¦½å™¨æœ‰æ™‚é–“è™•ç†
          if (i + removeBatchSize < storeMarkers.length) {
            await new Promise(resolve => setTimeout(resolve, 0));
          }
        }
        storeMarkers = [];
      }

      // ç²å–ç•¶å‰åœ°åœ–è¦–é‡ç¯„åœ
      const bounds = storeMap.getBounds();
      const north = bounds.getNorth();
      const south = bounds.getSouth();
      const east = bounds.getEast();
      const west = bounds.getWest();

      // éæ¿¾å‡ºè¦–é‡ç¯„åœå…§çš„markersï¼ˆä½¿ç”¨æ›´é«˜æ•ˆçš„éæ¿¾ï¼‰
      const visibleMarkers = [];
      // é™åˆ¶è™•ç†æ•¸é‡ï¼Œé¿å…å¡é “
      const maxCheck = Math.min(allMarkersData.length, 10000);
      for (let i = 0; i < maxCheck; i++) {
        const markerData = allMarkersData[i];
        if (markerData.lat >= south && 
            markerData.lat <= north && 
            markerData.lng >= west && 
            markerData.lng <= east) {
          visibleMarkers.push(markerData);
        }
        // é™åˆ¶æœ€å¤šé¡¯ç¤º300å€‹ï¼Œé¿å…éå¤šæ¨™è¨˜å°è‡´å¡é “
        if (visibleMarkers.length >= 300) {
          break;
        }
      }

      // æ‰¹é‡æ·»åŠ æ¨™è¨˜ï¼ˆåˆ†æ‰¹è™•ç†ï¼Œé¿å…é˜»å¡UIï¼‰
      const batchSize = 30;
      for (let i = 0; i < visibleMarkers.length; i += batchSize) {
        const batch = visibleMarkers.slice(i, i + batchSize);
        
        batch.forEach(markerData => {
          try {
            const iconPath = getBrandIconPath(markerData.brand);
            
            const customIcon = L.icon({
              iconUrl: iconPath,
              iconSize: [40, 40],
              iconAnchor: [20, 40],
              popupAnchor: [0, -40]
            });

            const marker = L.marker([markerData.lat, markerData.lng], {
              icon: customIcon
            })
              .addTo(storeMap)
              .bindPopup(`
                <div style="min-width: 200px;">
                  <strong>${markerData.display_name}</strong><br>
                  <small>${markerData.addr || ''}</small>
                </div>
              `);

            storeMarkers.push(marker);
          } catch (e) {
            console.warn('æ·»åŠ æ¨™è¨˜å¤±æ•—:', markerData, e);
          }
        });

        // æ¯æ‰¹ä¹‹é–“æš«åœï¼Œè®“ç€è¦½å™¨æœ‰æ™‚é–“æ¸²æŸ“
        if (i + batchSize < visibleMarkers.length) {
          await new Promise(resolve => setTimeout(resolve, 20));
        }
      }

      if (statusEl) {
        const totalText = visibleMarkers.length >= 300 ? '300+' : visibleMarkers.length.toString();
        statusEl.textContent = `å·²è¼‰å…¥ ${totalText} å€‹å•†å®¶ä½ç½®ï¼ˆç¸½å…± ${allMarkersData.length} å€‹ï¼‰`;
      }

      window.isRefreshingMarkers = false;
    }

    // å…¨å±€åˆ·æ–°å‡½æ•¸ï¼ˆä¾›æŒ‰éˆ•èª¿ç”¨ï¼‰
    window.refreshMapMarkers = refreshMapMarkers;

    // åˆå§‹åŒ–ä¸‹è¼‰æŒ‰éˆ•äº‹ä»¶è¿½è¹¤
    function initDownloadButtonTracking() {
      // å´é‚Šæ¬„ App Store æŒ‰éˆ•
      const sidebarAppStoreLink = document.getElementById('sidebar-app-store-link');
      if (sidebarAppStoreLink) {
        sidebarAppStoreLink.addEventListener('click', () => {
          if (window.logEvent && window.analytics) {
            try {
              window.logEvent(window.analytics, 'download_app_store_click', {
                source: 'sidebar'
              });
            } catch (error) {
              console.warn('Firebase Analytics äº‹ä»¶ç™¼é€å¤±æ•—:', error);
            }
          }
        });
      }

      // å´é‚Šæ¬„ Google Play æŒ‰éˆ•
      const sidebarGooglePlayLink = document.getElementById('sidebar-google-play-link');
      if (sidebarGooglePlayLink) {
        sidebarGooglePlayLink.addEventListener('click', () => {
          if (window.logEvent && window.analytics) {
            try {
              window.logEvent(window.analytics, 'download_google_play_click', {
                source: 'sidebar'
              });
            } catch (error) {
              console.warn('Firebase Analytics äº‹ä»¶ç™¼é€å¤±æ•—:', error);
            }
          }
        });
      }

      // æ¡Œé¢ç‰ˆ Header ä¸‹è¼‰æŒ‰éˆ•
      const desktopAppStoreLink = document.getElementById('desktop-app-store-link');
      if (desktopAppStoreLink) {
        desktopAppStoreLink.addEventListener('click', () => {
          if (window.logEvent && window.analytics) {
            try {
              window.logEvent(window.analytics, 'download_app_store_click', {
                source: 'desktop_header'
              });
            } catch (error) {
              console.warn('Firebase Analytics äº‹ä»¶ç™¼é€å¤±æ•—:', error);
            }
          }
        });
      }

      const desktopGooglePlayLink = document.getElementById('desktop-google-play-link');
      if (desktopGooglePlayLink) {
        desktopGooglePlayLink.addEventListener('click', () => {
          if (window.logEvent && window.analytics) {
            try {
              window.logEvent(window.analytics, 'download_google_play_click', {
                source: 'desktop_header'
              });
            } catch (error) {
              console.warn('Firebase Analytics äº‹ä»¶ç™¼é€å¤±æ•—:', error);
            }
          }
        });
      }

      // Bottom Info å€å¡Šä¸‹è¼‰æŒ‰éˆ•ï¼ˆæ‰‹æ©Ÿç‰ˆï¼‰
      const bottomAppStoreLink = document.getElementById('bottom-app-store-link');
      if (bottomAppStoreLink) {
        bottomAppStoreLink.addEventListener('click', () => {
          if (window.logEvent && window.analytics) {
            try {
              window.logEvent(window.analytics, 'download_app_store_click', {
                source: 'bottom_info'
              });
            } catch (error) {
              console.warn('Firebase Analytics äº‹ä»¶ç™¼é€å¤±æ•—:', error);
            }
          }
        });
      }

      const bottomGooglePlayLink = document.getElementById('bottom-google-play-link');
      if (bottomGooglePlayLink) {
        bottomGooglePlayLink.addEventListener('click', () => {
          if (window.logEvent && window.analytics) {
            try {
              window.logEvent(window.analytics, 'download_google_play_click', {
                source: 'bottom_info'
              });
            } catch (error) {
              console.warn('Firebase Analytics äº‹ä»¶ç™¼é€å¤±æ•—:', error);
            }
          }
        });
      }

      // ç§»å‹•ç«¯ header ä¸­çš„ä¸‹è¼‰æŒ‰éˆ•
      const mobileDownloadButtons = document.querySelectorAll('.mobile-download-btn');
      mobileDownloadButtons.forEach(btn => {
        btn.addEventListener('click', (e) => {
          if (window.logEvent && window.analytics) {
            const href = btn.getAttribute('href') || '';
            try {
              if (href.includes('apps.apple.com')) {
                window.logEvent(window.analytics, 'download_app_store_click', {
                  source: 'mobile_header'
                });
              } else if (href.includes('play.google.com')) {
                window.logEvent(window.analytics, 'download_google_play_click', {
                  source: 'mobile_header'
                });
              }
            } catch (error) {
              console.warn('Firebase Analytics äº‹ä»¶ç™¼é€å¤±æ•—:', error);
            }
          }
        });
      });
    }

    // åˆå§‹åŒ– Header ä¸‹è¼‰æŒ‰éˆ•é€£çµ
    function initHeaderDownloadButton() {
      const headerDownloadLink = document.getElementById('header-download-link');
      if (!headerDownloadLink) {
        return;
      }

      const device = detectDevice();

      // æ ¹æ“šè¨­å‚™é¡å‹è¨­ç½®é€£çµ
      if (device === 'ios') {
        headerDownloadLink.href = APP_STORE_URL;
      } else if (device === 'android') {
        headerDownloadLink.href = GOOGLE_PLAY_URL;
      } else {
        // é›»è…¦ç‰ˆæˆ–å…¶ä»–è¨­å‚™ï¼Œé»˜èªè·³è½‰åˆ° iOS App Store
        headerDownloadLink.href = APP_STORE_URL;
      }

      // æ·»åŠ é»æ“Šè¿½è¹¤
      headerDownloadLink.addEventListener('click', () => {
        if (window.logEvent && window.analytics) {
          try {
            const eventName = device === 'ios' ? 'download_app_store_click' : 
                             device === 'android' ? 'download_google_play_click' : 
                             'download_app_store_click';
            window.logEvent(window.analytics, eventName, {
              source: 'header_download_button',
              device: device
            });
          } catch (error) {
            console.warn('Firebase Analytics äº‹ä»¶ç™¼é€å¤±æ•—:', error);
          }
        }
      });
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      const appStoreLink = document.getElementById('sidebar-app-store-link');
      if (appStoreLink) {
        appStoreLink.href = APP_STORE_URL;
      }
      loadCoupons();
      initTabs();
      initMobileDownloadBanner();
      initDownloadButtonTracking();
      initHeaderDownloadButton();
    });

    // æ£€æµ‹è®¾å¤‡ç±»å‹å¹¶åˆå§‹åŒ–ç§»åŠ¨ç«¯ä¸‹è½½æ¨ªå¹…
    function detectDevice() {
      const userAgent = navigator.userAgent || navigator.vendor || window.opera;
      
      // æ£€æµ‹ iOS
      if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
        return 'ios';
      }
      
      // æ£€æµ‹ Android
      if (/android/i.test(userAgent)) {
        return 'android';
      }
      
      return 'unknown';
    }

    function initMobileDownloadBanner() {
      // åªåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ˜¾ç¤º
      if (window.innerWidth > 900) {
        return;
      }

      const device = detectDevice();
      const banner = document.getElementById('mobile-download-banner');
      const downloadButton = document.getElementById('mobile-download-button');
      
      if (!banner || !downloadButton) {
        return;
      }

      // æ ¹æ®è®¾å¤‡ç±»å‹è®¾ç½®ä¸‹è½½é“¾æ¥
      if (device === 'ios') {
        downloadButton.href = 'https://apps.apple.com/tw/app/%E6%97%A5%E6%9C%AC%E5%84%AA%E6%83%A0%E5%88%B8-2025-%E6%97%A5%E6%9C%AC%E8%B3%BC%E7%89%A9-%E6%97%85%E9%81%8A%E5%BF%85%E5%82%99-%E6%97%A5%E5%B9%A3%E6%8F%9B%E7%AE%97/id6449156306';
      } else if (device === 'android') {
        downloadButton.href = 'https://play.google.com/store/apps/details?id=com.junlando.japancoupon';
      } else {
        // æœªçŸ¥è®¾å¤‡ï¼Œæ˜¾ç¤ºä¸¤ä¸ªé“¾æ¥éƒ½æœ‰çš„é¡µé¢æˆ–é»˜è®¤é“¾æ¥
        downloadButton.href = 'https://play.google.com/store/apps/details?id=com.junlando.japancoupon';
      }

      // ç¡®ä¿åˆå§‹çŠ¶æ€
      banner.classList.remove('show', 'hide');
      
      // ä½¿ç”¨ requestAnimationFrame ç¡®ä¿åŠ¨ç”»èƒ½æ­£ç¡®è§¦å‘
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          banner.classList.add('show');
        });
      });

      // banner æ°¸ä¹…æ˜¾ç¤ºï¼Œä¸ä¼šè‡ªåŠ¨éšè—
    }
  </script>

  <!-- ç§»åŠ¨ç«¯ä¸‹è½½æ¨ªå¹… -->
  <div id="mobile-download-banner" class="mobile-download-banner">
    <div class="banner-content">
      <div class="banner-text">
        ä¸‹è¼‰æ‰‹æ©Ÿç‰ˆAPPï¼Œéš¨æ™‚éš¨åœ°ç²å–æŠ˜æ‰£ï¼
      </div>
      <a id="mobile-download-button" href="#" target="_blank" rel="noopener noreferrer" class="banner-button">
        é»æˆ‘ä¸‹è¼‰
      </a>
    </div>
  </div>
</body>
</html>
